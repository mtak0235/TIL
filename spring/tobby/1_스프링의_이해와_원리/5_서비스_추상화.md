ì§€ê¸ˆê¹Œì§€ ë§Œë“  DAO ì— transaction ì„ ì ìš©í•˜ë©´ì„œ ìŠ¤í”„ë§ì´ ì–´ë–»ê²Œ ì„±ê²©ì´ ë¹„ìŠ·í•œ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ê¸°ìˆ ì„ ì¶”ìƒí™”í•˜ê³  ì´ë¥¼ ì¼ê´€ëœ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ”ì§€ë¥¼ ì‚´í´ë³´ì.  

# 1. ì‚¬ìš©ì ë ˆë²¨ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€

í˜„ì¬ UserDaoëŠ” CRUDë§Œ ê°€ëŠ¥í•˜ë‹¤. ì—¬ê¸°ì— ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë³´ì
ë§Œë“¤ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

* ì‚¬ìš©ìì˜ ë ˆë²¨ì€ BASIC, SILVER, GOLD ì„¸ ê°€ì§€ ì¤‘ í•˜ë‚˜ë‹¤.
*  ì‚¬ìš©ìê°€ ì²˜ìŒ ê°€ì…í•˜ë©´ BASIC ë ˆë²¨ì´ ë˜ë©°, ì´í›„ í™œë™ì— ë”°ë¼ì„œ í•œ ë‹¨ê³„ì”© ì—…ê·¸ë ˆì´ë“œë  ìˆ˜  ìˆë‹¤. 
* ê°€ì… í›„ 50íšŒ ì´ìƒ ë¡œê·¸ì¸ì„ í•˜ë©´ BASICì—ì„œ SILVER ë ˆë²¨ì´ ëœë‹¤. 
* SILVER ë ˆë²¨ì´ë©´ì„œ 30ë²ˆ ì´ìƒ ì¶”ì²œì„ ë°›ìœ¼ë©´ GOLD ë ˆë²¨ì´ ëœë‹¤. 
* ì‚¬ìš©ì ë ˆë²¨ì˜ ë³€ê²½ ì‘ì—…ì€ ì¼ì •í•œ ì£¼ê¸°ë¥¼ ê°€ì§€ê³  ì¼ê´„ì ìœ¼ë¡œ ì§„í–‰ëœë‹¤
  ë³€ê²½ ì‘ì—… ì „ì—ëŠ” ì¡° ê±´ì„ ì¶©ì¡±í•˜ë”ë¼ë„ ë ˆë²¨ì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤

ğŸ˜ì¡°ê±´ì— ë”°ë¼ ì‚¬ìš©ìì˜ ë ˆë²¨ì„ ì£¼ê¸°ì ìœ¼ë¡œ ë³€ê²½í•œë‹¤ëŠ” ë‚´ìš©ì´ë¡œêµ°

## 1.1 í•„ë“œ ì¶”ê°€

### Level enum

User classì— ì‚¬ìš©ìì˜ ë ˆë²¨ì„ ì €ì¥í•  í•„ë“œë¥¼ ì¶”ê°€í•˜ì . 

ğŸ¤”varchar íƒ€ì…ìœ¼ë¡œ í• ê¹Œ? ë³„ë¡ ë°.. ê° ë ˆë²¨ì„ ì½”ë“œí™” í•´ì„œ ìˆ«ìë¡œ ë„£ì„ê¹Œ?

```java
class User {
private static final int BASIC = 1;
private static final int SILVER = 2;
private static final int GOLD = 3;
int level;
public void setLevel(int level) {
 this.level = level;
}
```

```java
if (user1.getLevel() = = User.BASIC) {
user1.setLevel(User.SILVER);
}
```

ğŸ¤”levelì˜ íƒ€ì…ì´ intë¼ì„œ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ì •ë³´ë¥¼ ë„£ê±°ë‚˜ ì—†ëŠ” ë²ˆí˜¸ë¥¼ ë„£ì–´ë„ ì»´íŒŒì¼ëŸ¬ê°€ ëª¨ë¥¼ ê²ƒ ê°™ë‹¤. 

``` java
user1.setLevel(other.getSum());
user1.setLevel(1000);
```

ğŸ˜java5 ~ ì˜  enumì„ ì‚¬ìš©í•˜ì

```java
package com.example.tobby.user.dao;

public enum Level {
    BASIC(1), SILVER(2), GOLD(3);
    private final int value;

    public int getValue() {
        return value;
    }

    Level(int value) {
        this.value = value;
    }

    public static Level valueOf(int value) {
        return switch (value) {
            case 1 -> BASIC;
            case 2 -> SILVER;
            case 3 -> GOLD;
            default -> throw new AssertionError("Unknown value: " + value);
        };
    }
}

```

### User í•„ë“œ ì¶”ê°€

Level typed ë³€ìˆ˜, ë¡œê·¸ì¸ íšŸìˆ˜, ì¶”ì²œìˆ˜ê¹Œì§€ User classì— ì¶”ê°€í•˜ì. 

### UserDaoTest ìˆ˜ì •

```java
    @BeforeEach
    private void setUp() {
        SingleConnectionDataSource dataSource = new SingleConnectionDataSource("jdbc:mysql://localhost/tobby", "tobaby", "0000", true);
//        dao.setDataSource(dataSource);
//        dao = context.getBean("userDao", UserDao.class);
        user3 = new User("mtak", "íƒë¯¼ê²½", "0000", Level.BASIC, 1, 0);
        user1 = new User("yeji", "íƒì˜ˆì§€", "0000", Level.SILVER, 55, 10);
        user2 = new User("doyun", "íƒë„ìœ¤", "000", Level.GOLD, 100, 40);
        
    }

```

â€‹	

```java
    private void checkSameUser(User user, User user1) {
        assertThat(user.getId()).isEqualTo(user1.getId());
        assertThat(user.getPassword()).isEqualTo(user1.getPassword());
        assertThat(user.getName()).isEqualTo(user1.getName());
        assertThat(user.getLevel()).isEqualTo(user1.getLevel());
        assertThat(user.getLogin()).isEqualTo(user1.getLogin());
        assertThat(user.getRecommend()).isEqualTo(user1.getRecommend());
    }
```

###  UserDaoJdbc ìˆ˜ì •

```java
    public void add(User user) {
        this.jdbcTemplate.update("insert into users (id, name, password, level, login, recommend) values(?,?,?, ?, ?, ?)", user.getId(), user.getName(), user.getPassword(), user.getLevel().intValue(), user.getLogin(), user.getRecommend());

    }
```

```java
public class UserDaoJdbc implements UserDao {

    private final RowMapper<User> userMapper = new RowMapper<>() {
        @Override
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            user.setLevel(Level.valueOf(rs.getString("level")));
            user.setLogin(rs.getInt("login"));
            user.setRecommend(rs.getInt("recommend"));
            return user;
        }
    };
    ...
}
```

## 1.2 ì‚¬ìš©ì ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€

