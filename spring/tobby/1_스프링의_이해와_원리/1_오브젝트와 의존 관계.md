ìŠ¤í”„ë§?
application framework

application framework?
applicationì˜ ê¸°ë³¸ í‹€ + ê³µí†µ í”„ë¡œê·¸ë˜ë° ëª¨ë¸
â¡ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ + IoC/DI, ì„œë¹„ìŠ¤ ì¶”ìƒí™”, AOP + ê¸°ìˆ  API

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ
(=application context)
ìŠ¤í”„ë§ ëŸ°íƒ€ì„ ì—”ì§„
ì—­í•  : ì„¤ì • ì •ë³´ë¥¼ ì°¸ê³ í•´ì„œ appì„ êµ¬ì„±í•˜ëŠ” OBJë¥¼ ìƒì„±&ê´€ë¦¬ í•œë‹¤.

 IoC/DI
Objì˜ ìƒëª… ì£¼ê¸°ì™€ ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ í”„ë¡œê·¸ë˜ë° ëª¨ë¸ì´ë‹¤. 

ì„œë¹„ìŠ¤ ì¶”ìƒí™”
êµ¬ì²´ì ì¸ ê¸°ìˆ ê³¼ í™˜ê²½ì— ì¢…ì†ë˜ì§€ ì•Šë„ë¡ ìœ ì—°í•œ ì¶”ìƒ ê³„ì¸µì„ ë‘ëŠ” ë°©ë²•

AOP
ì½”ë“œì— ì‚°ì¬í•œ ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ë…ë¦½ì ìœ¼ë¡œ ëª¨ë“ˆí™” í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ëª¨ë¸

ê¸°ìˆ  API
ì˜..ëª¨ë¥´ê² ìŒ.

----

>  springì˜ í•µì‹¬ì€ ê°ì²´ì§€í–¥ì ìœ¼ë¡œ appì„ ë§Œë“œëŠ”ë°ì— ìˆë‹¤.

# 1. ì´ˆë‚œê° DAO

* DAO
  * DBë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ì¡°ì‘í•˜ëŠ” ê¸°ëŠ¥ì„ ì „ë‹´í•˜ë„ë¡ ë§Œë“  ì˜¤ë¸Œì íŠ¸

ğŸ˜ì‚¬ìš©ì ì •ë³´ë¥¼  JDBC API ë¥¼ í†µí•´ DBì— ì €ì¥í•˜ê³   ì¡°íšŒí•  ìˆ˜ ìˆëŠ” DAOë¥¼ ë§Œë“¤ì–´ ë³´ì

> JavaBean
>
> * ë””í´íŠ¸ìƒì„±ì + prpopertyë¥¼ ê°€ì§„ ê°ì²´

* JDBCë¥¼ ì´ìš©í•˜ëŠ” ì‘ì—…ì˜ ìˆœì„œ
  1.  DBì—°ê²°ìš© connectionì„ ê°€ì ¸ì˜¨ë‹¤.
  2. SQLì„ ë‹´ì€ statementë¥¼ ë§Œë“ ë‹¤.
  3. ë§Œë“  statementë¥¼ ì‹¤í–‰í•œë‹¤.
  4. ì¡°íšŒì˜ ê²½ìš°, SQLì¿¼ë¦¬ì˜ ì‹¤í–‰ ê²°ê³¼ëŠ” ResultSetìœ¼ë¡œ ë°›ì•„ì„œ ì •ë³´ë¥¼ ì €ì¥í•  ê°ì²´ì— ë‹´ì•„ì¤€ë‹¤.
  5. ì‘ì—…ì¤‘ì— ìƒì„±ëœ Connection, Statement, ResultSet ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ë‹«ì•„ì¤€ë‹¤.
  6. JDBC APIê°€ ë§Œë“  Exceptionì„ ì§ì ‘ ì²˜ë¦¬í•˜ê±°ë‚˜ ë©”ì†Œë“œì— throwsë¥¼ ì„ ì–¸í•´ ì±…ì„ì„ ì „ê°€í•œë‹¤.

```java
package org.example.user.dao;

import org.example.user.domain.User;

import java.sql.*;

public class UserDao {
    public void add(User user) throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }
}

```

```java
package org.example.user.domain;

public class User {
    String id;
    String name;
    String password;

    public String getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public String getPassword() {
        return password;
    }

    public void setId(String id) {
        this.id = id;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}

```

```java
package org.example.user;

import org.example.user.dao.UserDao;
import org.example.user.domain.User;

import java.sql.SQLException;

public class Main {
    public static void main(String[] args) throws SQLException, ClassNotFoundException {
        UserDao dao = new UserDao();
        User user = new User();
        user.setId("mtak8");
        user.setName("íƒë¯¼ê²½");
        user.setPassword("1004");
        dao.add(user);
        System.out.println("succeed " + user.getId());

        User user1 = dao.get(user.getId());
        System.out.println(user1.getId());
        System.out.println(user1.getName());
        System.out.println(user1.getPassword());
        System.out.println("succeed" + user1.getId());
    }
}

```

# 2. DAOì˜ ë¶„ë¦¬

## 2.1 ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

ë³€í™”ê°€ í•œë²ˆì— í•œê°€ì§€ ê´€ì‹¬ì— ì§‘ì¤‘ì ìœ¼ë¡œ ì¼ì–´ë‚˜ë©´, ìš°ë¦¬ëŠ” ê·¸ í•œ ê°€ì§€ ê´€ì‹¬ì´ í•œ êµ°ë°ì— ì§‘ì¤‘ë˜ê²Œ í•´ ì¤˜ì•¼ í•œë‹¤.

## 2.2 ì»¤ë„¥ì…˜ ë§Œë“¤ê¸°ì˜ ì¶”ì¶œ

ğŸ˜í˜„ì¬ DAOì˜ add()ë§Œ ë´ë„ ê´€ì‹¬ ì‚¬í•­ì´ 3ê°€ì§€ë‚˜ ìˆë‹¤?

1. DBì™€ ì—°ê²°ì„ ìœ„í•œ ì»¤ë„¥ì…˜.
   1. ì–´ë–¤ ë“œë¼ì´ë²„ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ì§€
   2. ì–´ë–¤ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì“°ëŠ”ì§€
   3. ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ëŠ” ë°©ë²• ë­ ì“°ëŠ”ì§€
2. SQL ë‹´ì„ Statement ë§Œë“¤ê³  ì‹¤í–‰
   1. parameterë¡œ ë„˜ì–´ì˜¨ ì¶”ê°€ ì •ë³´ë¥¼ statementì— ë°”ì¸ë”© í•˜ëŠ” ê²ƒ
   1. ì–´ë–¤ SQLì‚¬ìš©í• ì§€
3. ì‚¬ìš©í•œ ë¦¬ì†ŒìŠ¤ë“¤(statement, Connection) í•´ì œ

ğŸ˜ì»¤ë„¥ì…˜ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ë³µëœ ì½”ë“œë¥¼ ë¶„ë¦¬í•´ë³´ì

```java
package org.example.user.dao;

import org.example.user.domain.User;

import java.sql.*;

public class UserDao {
    public void add(User user) throws ClassNotFoundException, SQLException {
        Connection c = getConnection();

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Connection c = getConnection();

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }

    private static Connection getConnection() throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");
        return c;
    }
}

```

## 2.3  DB connection  ë§Œë“¤ê¸°ì˜ ë…ë¦½

ğŸ˜ UserDaoì½”ë“œ ìˆ¨ê²¨ì„œ íŒë§¤í•˜ê³  ì‹¶ì€ë° getConnectio n ë¶€ë¶„ì´ ê±°ë˜ì²˜ë§ˆë‹¤ ë‹¤ë¥´ë„¤,,
ìƒì†ì„ í†µí•´ í™•ì¥í•´ ë³¼ê¹Œ?

```java
package org.example.user.dao;

import org.example.user.domain.User;

import java.sql.*;

public abstract class UserDao {
    public void add(User user) throws ClassNotFoundException, SQLException {
        Connection c = getConnection();

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Connection c = getConnection();

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }

    public abstract Connection getConnection() throws ClassNotFoundException, SQLException;
}

```

```java
package org.example.user.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DUserDao extends UserDao {
    @Override
    public Connection getConnection() throws ClassNotFoundException, SQLException {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");
            return c;
    }
}
```

```java
package org.example.user.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class NUserDao extends UserDao {
    @Override
    public Connection getConnection() throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");
        return c;
    }
}

```

ğŸ˜UserDaoìˆ˜ì • ì—†ì´ DB ì—°ê²° ë°©ë²•ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤!

> ì´ë ‡ê²Œ ìŠˆí¼ í´ë˜ìŠ¤ì—ì„œ ê¸°ë³¸ ë¡œì§ ë§Œë“¤ê³ , ê·¸ ì¼ë¶€ë¥¼ ì¶”ìƒí™” ì‹œì¼œ(ì¶”ìƒ ë©”ì†Œë“œë‚˜ protected ë©”ì†Œë“œ etc) ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ ì´ê±¸ í•„ìš”ì— ë§ê²Œ êµ¬í˜„í•´ì„œ ì‚¬ìš©í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ì„ **template method pattern**ì´ë¼ê³  í•œë‹¤.
> ì´ë ‡ê²Œ ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ êµ¬ì²´ì ì¸ obj ìƒì„± ë°©ë²•ì„ ê²°ì •í•˜ëŠ” ê²ƒì„ **factory method pattern**ì´ë¼ê³  í•œë‹¤.

# 3. DAOì˜ í™•ì¥

ğŸ™„ë°ì´í„° ì•¡ì„¸ìŠ¤ ë¡œì§ê³¼ DBì—°ê²° ë¡œì§. ì´ ë‘ ê´€ì‹¬ì‚¬ë¥¼ ìƒí•˜ìœ„ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬ì‹œì¼°ë‹¤. 
ê·¸ì¹˜ë§Œ ìƒì†ì„ ì‚¬ìš©í–ˆë„¤? 
ì„œë¸Œ í´ë˜ìŠ¤ê°€ ìŠˆí¼ í´ë˜ìŠ¤ì˜ ë³€í™”ì— ì˜í–¥ì„ ë°›ì•„ë²„ë¦°ë‹¤...
ë¿ë§Œ ì•„ë‹ˆë‹¤ DAOë§ˆë‹¤ getConnection() ì •ì˜ê°€ ì¤‘ë³µí•´ì„œ ë‚˜íƒ€ë‚ ê±°ë‹¤..

## 3.1 í´ë˜ìŠ¤ì˜ ë¶„ë¦¬

ğŸ˜ì§€ê¸ˆê¹Œì§€ ì € ë‘ ê´€ì‹¬ì‚¬ë¥¼ ë…ë¦½ëœ ë©”ì†Œë“œë¡œ ì°¢ì–´ë³´ê³ , ìƒí•˜ìœ„ í´ë˜ìŠ¤ë¡œë„ ë¶„ë¦¬í•´ ë³´ì•˜ë‹¤. ì´ë²ˆì—ëŠ” ì•„ì˜ˆ ë…ë¦½ì ì¸ í´ë˜ìŠ¤ë¡œ ì°¢ì–´ë³´ì. 

```java
package org.example.user.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class SimpleConnectionMaker {
    public Connection makeNewConnection() throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");
        return c;
    }
}
```

```java
package org.example.user.dao;

import org.example.user.domain.User;

import java.sql.*;

public class UserDao {

    private SimpleConnectionMaker simpleConnectionMaker;

    public UserDao(SimpleConnectionMaker simpleConnectionMaker) {
        this.simpleConnectionMaker = simpleConnectionMaker;
    }

    public void add(User user) throws ClassNotFoundException, SQLException {
        Connection c = simpleConnectionMaker.makeNewConnection();

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Connection c = simpleConnectionMaker.makeNewConnection();

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }
}

```

ğŸ™„ì´ë ‡ê²Œ í•˜ë‹ˆê¹Œ DUserDao, NUserDaoì´ ì œê³µí•˜ëŠ” ì»¤ë„¥ì…˜ ê¸°ëŠ¥ì„ ì“°ë ¤ë©´ ë˜ UserDaoë¥¼ ìˆ˜ì •í•´ì•¼ ë˜ë„¤?

## 3.2 ì¸í„°í˜ì´ìŠ¤ ë„ì…

```java
package org.example.user.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

interface ConnectionMaker {
    public Connection makeConnection() throws ClassNotFoundException, SQLException;
}

```

```java
package org.example.user.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DUserDao implements ConnectionMaker {

    @Override
    public Connection makeConnection() throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/tobby", "tobaby", "0000");
        return c;
    }
}

```

```java
package org.example.user.dao;

import org.example.user.domain.User;

import java.sql.*;

public class UserDao {

    private ConnectionMaker connectionMaker;

    public UserDao() {
        this.connectionMaker = new DUserDao();
    }

    public void add(User user) throws ClassNotFoundException, SQLException {
        Connection c = connectionMaker.makeConnection();

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Connection c = connectionMaker.makeConnection();

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }
}

```

ğŸ™„UserDaoì—ì„œ Connection ì˜ êµ¬í˜„ì²´ë¥¼ ì•Œê³  ìˆë„¤?

## 3.3 ê´€ê³„ ì„¤ì • ì±…ì„ì˜ ë¶„ë¦¬

ğŸ¤”ë¶„ë¦¬ ë˜ì§€ ì•Šì€ ê´€ì‹¬ì‚¬ê°€ UserDaoì— ìˆë‹¤. UserDao-UserDaoê°€ ì“¸ ConnectionMaker ì˜ íŠ¹ì • êµ¬í˜„ í´ë˜ìŠ¤ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì— ëŒ€í•œ ê´€ì‹¬!

UserDaoë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê´€ê³„ ì„¤ì •ì„ í•´ì£¼ë©´ ì–´ë–¨ê¹Œ?

> DUserDao -> DConnectionMaker
> NUserDao -> NConnectionMaker
> ì´ë¦„ ë³€ê²½

```java
package org.example.user;

import org.example.user.dao.DConnectionMaker;
import org.example.user.dao.NUserDao;
import org.example.user.dao.UserDao;
import org.example.user.domain.User;

import java.sql.SQLException;

public class Main {
    public static void main(String[] args) throws SQLException, ClassNotFoundException {
        UserDao dao = new UserDao(new DConnectionMaker());
        User user = new User();
        user.setId("mtak1");
        user.setName("íƒë¯¼ê²½");
        user.setPassword("1004");
        dao.add(user);
        System.out.println("succeed " + user.getId());

        User user1 = dao.get(user.getId());
        System.out.println(user1.getId());
        System.out.println(user1.getName());
        System.out.println(user1.getPassword());
        System.out.println("succeed" + user1.getId());
    }
}

```

## 3.4 ì›ì¹™ê³¼ íŒ¨í„´

### ê°œë°© íì‡„ ì›ì¹™

* OCP (open closed principle)
* í´ë˜ìŠ¤ë‚˜ ëª¨ë“ˆì€ í™•ì¥ì—ëŠ” ì—´ë ¤ ìˆì–´ì•¼ í•˜ê³  ë³€ê²½ì—ëŠ” ë‹«í˜€ ìˆì–´ì•¼ í•œë‹¤.
* UserDaoëŠ” *DB ì—°ê²°* ê¸°ëŠ¥ì„ í™•ì¥í•˜ëŠ”ë°ëŠ” ì—´ë ¤ìˆê³ , ìì‹ ì˜ í•µì‹¬ ì½”ë“œëŠ” ê·¸ëŸ° ë³€í™”ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê³  ë‹«í˜€ ìˆë‹¤. 

### ë†’ì€ ì‘ì§‘ë„ì™€ ë‚®ì€ ê²°í•©ë„

* ë†’ì€ ì‘ì§‘ë„
  * í•˜ë‚˜ì˜ ëª¨ë“ˆ, í´ë˜ìŠ¤ê°€ í•˜ë‚˜ì˜ ì±…ì„ ë˜ëŠ” ê´€ì‹¬ì‚¬ì—ë§Œ ì§‘ì¤‘ë˜ì–´ ìˆë‹¤
  * ë¶ˆí•„ìš”í•˜ê±°ë‚˜ ì§ì ‘ ê´€ë ¨ì´ ì—†ëŠ” ì™¸ë¶€ì˜ ê´€ì‹¬ê³¼ ì±…ì„ì´ ì–½í˜€ìˆì§€ ì•Šë‹¤
* ë‚®ì€ ê²°í•©ë„
  * ì±…ì„ê³¼ ê´€ì‹¬ì‚¬ê°€ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ ë˜ëŠ” ëª¨ë“ˆê³¼ëŠ” ëŠìŠ¨í•˜ê²Œ ì—°ê²°ëœ í˜•íƒœë¥¼ ìœ ì§€í•œë‹¤.
  * ê²°í•©ë„
    * í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ê°€ ë³€ê²½ì´ ì¼ì–´ë‚  ë•Œ, ê´€ê³„ë¥¼ ë§ºê³  ìˆëŠ” ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì—ê²Œ ë³€í™”ë¥¼ ìš”êµ¬í•˜ëŠ” ì •ë„

### ì „ëµ íŒ¨í„´

* strategy pattern
  * ìì‹ ì˜ ê¸°ëŠ¥ ë§¥ë½(context)ì—ì„œ í•„ìš”ì— ë”°ë¼ ë³€ê²½ì´ í•„ìš”í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ í†µì§¸ë¡œ ì™¸ë¶€ë¡œ ë¶„ë¦¬ì‹œí‚¤ê³ , ì´ë¥¼ êµ¬í˜„í•œ êµ¬ì²´ì ì¸ ì•Œê³ ë¦¬ì¦˜(strategy) í´ë˜ìŠ¤ë¥¼ í•„ìš”ì— ë”°ë¼ ë°”ê¿”ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë””ìì¸ íŒ¨í„´
  * UserDao ê°€ context. ConnectionMakerê°€ ë³€ê²½ ê°€ëŠ¥í•œ strategy.UserDaoTestëŠ” contextê°€ ì‚¬ìš©í•  strategyë¥¼ ì œê³µ.

# 4. ì œì–´ì˜ ì—­ì „ (IoC)

## 4.1 ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬

ğŸ¤”UserDaoTestì— ConnectionMakerêµ¬í˜„ì²´ì™€ UserDaoì˜ ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ì¼ì„ ì–¼ë ëš±ë•… ë„˜ê²¼ë‹¤..
ì´ì œ ConnectionMakerì˜ êµ¬í˜„ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì™€ UserDao ì¸íŠ¸ì„ ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒê³¼
ê·¸ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ë‘ ì˜¤ë¸Œì íŠ¸ê°€ ì—°ê²°ë¼ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆê²Œ ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ê¸°ëŠ¥ë“¤ì„ UserDaoTestë¡œ ë¶€í„° ë¶„ë¦¬í•´ ë³´ì.

### íŒ©í† ë¦¬

ê°ì²´ì˜ ìƒì„± ë°©ë²•ì„ ê²°ì •í•˜ê³  ê·¸ë ‡ê²Œ ë§Œë“¤ì–´ì§„ objë¥¼ ëŒë ¤ì£¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ **factory**ë¼ê³  ë¶€ë¥¸ë‹¤.

ëª©ì ì€ ë‹¨ í•˜ë‚˜. ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ìª½ê³¼ ìƒì„±ëœ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ìª½ì˜ ì±…ì„ì„ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤. 

> ë””ìì¸ íŒ¨í„´ì˜ ì¶”ìƒ íŒ©í† ë¦¬ íŒ¨í„´ì´ë‚˜ íŒ©í† ë¦¬ ë©”ì†Œë“œ íŒ¨í„´ê³¼ ë‹¤ë¥´ë‹¤.

```java
package org.example.user.dao;

import org.example.user.domain.User;
import org.junit.jupiter.api.Test;

import java.sql.SQLException;

class UserDaoTest {

    @Test
    public void testConnection() throws SQLException, ClassNotFoundException {
        UserDao dao = new DaoFactory().userDao();
        User user = new User();
        user.setId("mtak1");
        user.setName("íƒë¯¼ê²½");
        user.setPassword("1004");
        dao.add(user);
        System.out.println("succeed " + user.getId());

        User user1 = dao.get(user.getId());
        System.out.println(user1.getId());
        System.out.println(user1.getName());
        System.out.println(user1.getPassword());
        System.out.println("succeed" + user1.getId());
    }
}
```

```java
package org.example.user.dao;

public class DaoFactory {
    public UserDao userDao() {
        ConnectionMaker connectionMaker = new DConnectionMaker();
        UserDao userDao = new UserDao(connectionMaker);
        return userDao;
    }
}

```

### ì„¤ê³„ë„ë¡œì„œì˜ íŒ©í† ë¦¬

* ì‹¤ì§ˆì ì¸ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
  * UserDao
    * ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ì ì¸ ë°ì´í„° ë¡œì§ì„ ë‹´ë‹¹
  * ConnectionMaker
    * ê¸°ìˆ  ë¡œì§ ë‹´ë‹¹
* ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ êµ¬ì¡°ì™€ ê´€ê³„ë¥¼ ì •ì˜í•œ ì„¤ì„¤ê³„ë„
  * DaoFactory
    * ì˜¤ë¸Œì íŠ¸ë¥¼ êµ¬ì„±í•˜ê³  ê´€ê³„ë¥¼ ì •ì˜

ğŸ˜ŠDaoFactoryë¥¼ ë¶„ë¦¬í•˜ë‹ˆê¹Œ application componentì—­í• ì„ í•˜ëŠ” objì™€ applicationì˜ êµ¬ì¡°ë¥¼ ê²°ì •í•˜ëŠ” êµ¬ì¡°ë¥¼ ê²°ì •í•˜ëŠ” objë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆê²Œ ëì–´!

## 4.2 ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ì˜ í™œìš©

ğŸ¤”AccountDao, MessageDaoê°€ ì¶”ê°€ë˜ì„œ DaoFactoryì— accountDao(), messageDao()ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤ë©´?

```java
package org.example.user.dao;

public class DaoFactory {
    public UserDao userDao() {
        ConnectionMaker connectionMaker = new DConnectionMaker();
        UserDao userDao = new UserDao(connectionMaker);
        return userDao;
    }
    public AccountDao accountDao() {
        ConnectionMaker connectionMaker = new DConnectionMaker();
        AccountDao accountDao = new AccountDao(connectionMaker);
        return accountDao;
    }
    public MessageDao messageDao() {
        ConnectionMaker connectionMaker = new DConnectionMaker();
        MessageDao messageDao = new MessageDao(connectionMaker);
        return messageDao;
    }
}

```

ğŸ™„ì–´ë–¤ ConnectionMaker êµ¬í˜„ì²´ë¥¼ ì“¸ì§€ ê²°ì •í•˜ëŠ” ì½”ë“œê°€ ì¤‘ë³µí•´ì„œ ë‚˜íƒ€ë‚˜ë„¤?

í•¨ìˆ˜ë¡œ ì¶”ì¶œí•˜ì

```java
package org.example.user.dao;

public class DaoFactory {
    public UserDao userDao() {
        UserDao userDao = new UserDao(connectionMaker());
        return userDao;
    }
    public AccountDao accountDao() {
        AccountDao accountDao = new AccountDao(connectionMaker());
        return accountDao;
    }
    public MessageDao messageDao() {
        MessageDao messageDao = new MessageDao(connectionMaker());
        return messageDao;
    }

    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
}

```

## 4.3 ì œì–´ê¶Œì˜ ì´ì „ì„ í†µí•œ ì œì–´ ê´€ê³„ì˜ ì—­ì „

ğŸ¥ºì¼ë°˜ì ìœ¼ë¡œ í”„ë¡œê·¸ë¨ì˜ íë¦„ì€ clientê°€ ìì‹ ì´ í•„ìš”í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ê²°ì •í•˜ê³  í•„ìš”í•œ ì‹œì ì—ì„œì•¼ ìƒì„±í•˜ë©° ë§Œë“  ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í–ˆë‹¤.

clientê°€ ì œì–´í–ˆë‹¤.

ğŸ˜ì œì–´ì˜ ì—­ì „ì´ë€ ì˜ˆì‹œë¥¼ ë¨¼ì € ë“¤ì–´ë³´ì. 

1. ì„œë¸”ë¦¿ì—” main()ì´ ì—†ë‹¤. ì„œë¸”ë¦¿ì„ ì§€ë°°í•˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ì ë‹¹í•œ ë•Œ ì„œë¸”ë¦¿ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. jsp, ejbë„ ì»¨í…Œì´ë„ˆì˜ ì§€ë°°ë¥¼ ë°›ëŠ”ë‹¤. 

2. í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì—ì„œ UserDaoì—ì„œ ì¶”ìƒ ë©”ì†Œë“œ getConnection()ë¥¼ ë§Œë“¤ì–´ ë†“ìœ¼ë©´ UserDaoë¥¼ êµ¬í˜„í•˜ëŠ” ì„œë¸Œ ë©”ì†Œë“œì•¼ ì¼ë‹¨ ì˜ë¬´ì ìœ¼ë¡œ getConnetion()ì„ êµ¬í˜„í•˜ê¸´ í•˜ì§€ë§Œ ê·¸ê²Œ ì–¸ì œ ì–´ë–»ê²Œ ì‚¬ìš©ë ì§€ëŠ” ëª¨ë¥¸ë‹¤.  ìŠˆí¼ í´ë˜ìŠ¤ì¸ UserDaoì˜ í…œí”Œë¦¿ ë©”ì†Œë“œì¸ add(), get()ê°€  í•„ìš”í•  ë•Œ getConnection()ì„ ì‚¬ìš©í•œë‹¤. 

   ì„œë¸Œ í´ë˜ìŠ¤ëŠ” (getConnection()ì˜ )ì œì–´ê¶Œì„ ìƒìœ„ í…œí”Œë¦¿ ë©”ì†Œë“œì— ë„˜ê¸°ê³  ìì‹ ì€ í•„ìš”í•  ë•Œ í˜¸ì¶œë‹¹í•œë‹¤. 

3. í”„ë ˆì„ì›Œí¬ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ë‹¤ë¥´ë‹¤. í”„ë ˆì„ì›Œí¬ ìœ„ì— ê°œë°œí•œ í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•´ ë‘ê³ , í”„ë ˆì„ì›Œí¬ê°€ íë¦„ì„ ì£¼ë„í•˜ëŠ” ì¤‘ì— ê°œë°œìê°€ ë§Œë“  ì–´í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“ ë‹¤.

   ì–´í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œëŠ” í”„ë ˆì„ì›Œí¬ê°€ ì§œ ë†“ì€ í‹€ì—ì„œ ìˆ˜ë™ì ìœ¼ë¡œ ë™ì‘í•´ì•¼ í•œë‹¤. 

 ì œì–´ì˜ ì—­ì „ì—ëŠ” í”„ë ˆì„ì›Œí¬, ì»¨í…Œì´ë„ˆ ê°™ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»´í¬ë„ŒíŠ¸ì˜ ìƒì„±ê³¼ ê´€ê³„ ì„¤ì •, ì‚¬ìš©, ìƒëª…ì£¼ê¸° ê´€ë¦¬ ë“¤ì„ ê´€ì¥í•˜ëŠ” ì¡´ì¬ê°€ í•„ìš”í•˜ë‹¤. 

DaoFactoryëŠ” obìˆ˜ì¤€ì˜ ê°€ì¥ ê°„ë‹¨í•œ IoC container, IoC frameworkë¼ ë¶ˆë¦´ ìˆ˜ ìˆë‹¤. IoC ì œì–´ê¶Œì„ ê°€ì¡Œì§€ ì•Šì€ê°€?

# 5. ìŠ¤í”„ë§ì˜ IoC

ìŠ¤í”„ë§ì€ application ê°œë°œì˜ ë‹¤ì–‘í•œ ì˜ì—­ê³¼ ê¸°ìˆ ì— ê´€ì—¬í•˜ì§€ë§Œ,
ìŠ¤í”„ë§ì˜ í•µì‹¬ì€ application context(bean factory)ë‹¤.
ì§€ê¸ˆê¹Œì§€ ë§Œë“  DaoFactoryê°€ í•˜ëŠ” ì¼ì„ ë” ì¼ë°˜í™” í•œ ê²ƒì´ë‹¤ 

## 5.1 ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ë¥¼ ì´ìš©í•œ ìŠ¤í”„ë§ IoC

### application contextì™€ ì„¤ì • ì •ë³´

ìŠ¤í”„ë§ì—ì„œ, 

ìŠ¤í”„ë§(container)ì´ ì œì–´ê¶Œì„ ê°€ì§€ê³  ì§ì ‘ ë§Œë“¤ê³  ê´€ê³„ë¥¼ ë¶€ì—¬í•˜ëŠ”(ì œì–´ì˜ ì—­ì „ì´ ì ìš©ëœ) ì˜¤ë¸Œì íŠ¸ë¥¼ beanì´ë¼ ë¶€ë¥¸ë‹¤. 

ë¹ˆì˜ ìƒì„±ê³¼ ê´€ê³„ ì„¤ì • ê°™ì€ ì œì–´ë¥¼ ë‹´ë‹¹í•˜ëŠ” IoC objectë¥¼ bean factory(=application context)ë¼ ë¶€ë¥¸ë‹¤.
êµ³ì´ êµ¬ë¶„í•˜ìë©´,
bean factoryëŠ” ë¹ˆì„ ìƒì„±í•˜ê³  ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” IoCì˜ ê¸°ë³¸ ê¸°ëŠ¥ì— ì´ˆì ì„ ë‘” ê²ƒì´ê³ ,
application contextëŠ” application ì „ë°˜ì— ê±¸ì³ ëª¨ë“  êµ¬ì„± ìš”ì†Œì˜ ì œì–´ ì‘ì—…ì„ ë‹´ë‹¹í•˜ëŠ” IoC ì—”ì§„ì´ë¼ëŠ” ì ì— ì´ˆì ì„ ë‘” ê²ƒì´ë‹¤. 
DaoFactoryì²˜ëŸ¼ ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì–´ë””ì— ì—°ê²°í• ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì§ì ‘ ë‹´ê³  ìˆì§€ëŠ” ì•Šì§€ë§Œ, ë”°ë¡œ **ì„¤ì • ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ë¬´ì–¸ê°€**ë¥¼ ê°€ì ¸ì™€ ì´ë¥¼ í™œìš©í•œë‹¤. (~~ë¬¼ë¡  DaoFactoryëŠ” ì„¤ì •ì •ë³´ê¹Œì§€ í¬í•¨í•œ IoCì—”ì§„ì´ë‹¤.~~)

### DaoFactoryë¥¼ ì‚¬ìš©í•˜ëŠ” application context

ğŸ˜DaoFactoryë¥¼ ìŠ¤í”„ë§ì˜ ë¹ˆ íŒ©í† ë¦¬ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë³¸ê²©ì ì¸ ì„¤ì • ì •ë³´ë¡œ ë§Œë“¤ì–´ë³´ì. 
@Configuration : "ì´ê±´ bean factoryë¥¼ ìœ„í•œ objì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤ ì…ë‹ˆë‹¤!"

@Bean: "ì´ê±´ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“œëŠ” ë©”ì†Œë“œ ì…ë‹ˆë‹¤!"

```java
package com.example.tobby.user.dao;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class DaoFactory {
    @Bean
    public UserDao userDao() {
        UserDao userDao = new UserDao(connectionMaker());
        return userDao;
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
}

```



ğŸ˜ì´ì œ DaoFactoryë¥¼ ì„¤ì • ì •ë³´ë¡œ ì‚¬ìš©í•˜ëŠ” application contextë¥¼ ë§Œë“¤ì–´ ë³´ì! 

application contextëŠ” ApplicationConetextíƒ€ì…ì˜ objë‹¤.
êµ¬í˜„ì²´ëŠ” ì—¬ëŸ¬ê°œì¸ë° @Configurationì´ ë¶™ì€ ìë°” ì½”ë“œë¥¼ ì„¤ì • ì •ë³´ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ AnnotationConfigContextë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤! 
ë§Œë“¤ ë•Œ ìƒì„±ì íŒŒë¼í‚¤í„°ë¡œ DaoFactory classë„£ì–´ì£¼ëŠ”ê²ƒ ê¹Œë¨¹ì§€ ë§ê³ !

ì¤€ë¹„ëœ ApplicationContextì˜ getBean()ìœ¼ë¡œ UserDao objë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 

```java
package com.example.tobby;

import com.example.tobby.user.dao.DConnectionMaker;
import com.example.tobby.user.dao.DaoFactory;
import com.example.tobby.user.dao.UserDao;
import com.example.tobby.user.domain.User;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import java.sql.SQLException;

public class TobbyApplication {

    public static void main(String[] args) throws SQLException, ClassNotFoundException {
        ApplicationContext applicationContext = new AnnotationConfigApplicationContext(DaoFactory.class);
        UserDao dao = applicationContext.getBean("userDao", UserDao.class);
        User user = new User();
        user.setId("mtak3");
        user.setName("íƒë¯¼ê²½");
        user.setPassword("1004");
        dao.add(user);
        System.out.println("succeed " + user.getId());

        User user1 = dao.get(user.getId());
        System.out.println(user1.getId());
        System.out.println(user1.getName());
        System.out.println(user1.getPassword());
        System.out.println("succeed" + user1.getId());
    }

}

```

ğŸ˜Šì•„ê¹Œ @Beanì„ ë¶™ì˜€ë˜ í•¨ìˆ˜ `userDao`ê°€ ê·¸ëŒ€ã…ë¡œ ë¹ˆì˜ ì´ë¦„ì´ ë¬ë‹¤. ìš°ë¦°ê°€ getBean()ì˜ íŒŒë¼ë¯¸í„°ë¡œ "userDao" , ì¦‰ application contextì— ë“±ë¡ëœ ë¹ˆì˜ ì´ë¦„ì„ ì ì€ ì´ìœ ì´ì§€.

ğŸ¤·â€â™‚ï¸ì• ì´ˆì— userDaoë§Œë“œëŠ” í•¨ìˆ˜ ì´ë¦„ì€ cutieUserDao()ë¡œ ì§€ì—ˆì–´ë„, getBean()ì˜ íŒŒë¼ë¯¸í„°ë¡œ "cutieUserDao"ë¡œ ë¹ˆì„ ì°¾ì„ ìˆ˜ ìˆì—ˆëŠ”ë°!!

## 5.2 application contextì˜ ë™ì‘ ë°©ì‹

ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬(DaoFactory)ì— ëŒ€ì‘ë˜ëŠ” ê²ƒì´ ìŠ¤í”„ë§ì˜ application contextë‹¤. 

application contextì˜ ë‹¤ì–‘í•œ ì´ë¦„

* ioc container
* spring container
* bean factory (ì—„ë°€íˆ í•˜ë©´ ì–˜ê°€ ë¶€ëª¨ ì¸í„°í˜ì´ìŠ¤ì„)

ğŸ¤”ê·¸ë ‡ë‹¤ë©´ DaoFactoryì™€ application contextëŠ” ë¬´ìŠ¨ ì°¨ì´ê°€ ìˆë‚˜?

 DaoFactoryëŠ” Dao objë¥¼ ìƒì„±í•˜ê³  DBìƒì„± objì™€ ê´€ê³„ë¥¼ ë§ºì–´ì¤€ë‹¤.
ApplicationContextëŠ” IoCë¥¼ ì ìš©í•  ëª¨ë“  objë¥¼ ìƒì„±ê³¼ ê´€ê³„ ì„¤ì •ì„ ë‹´ë‹¹í•œë‹¤. 
ë‹¨, ì§ì ‘ objë¥¼ ìƒì„±í•˜ê³  ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ì½”ë“œê°€ ìˆëŠ”ê±´ ì•„ë‹ˆê³ ,  ê·¸ëŸ° ìƒì„± ì •ë³´ì™€ ì—°ê´€ê´€ê³„ ì •ë³´ë¥¼ ë³„ë„ì˜ ì„¤ì • ì •ë³´(Ex. @Configurationì´ ë¶™ì€ í´ë˜ìŠ¤)ë¥¼ í†µí•´ ì–»ëŠ”ë‹¤. 

ğŸ¤”

![image](https://github.com/mtak0235/TIL/assets/48946398/71910569-629d-4814-914e-71edcc054024)

1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” DaoFactory í´ë˜ìŠ¤ë¥¼ ì„¤ì •ì •ë³´ë¡œ ë“±ë¡í•´ë‘ê³  @Beanì´ ë¶™ì€ë©”ì†Œë“œì˜ ì´ë¦„ì„ ê°€ì ¸ì™€ ë¹ˆ ëª©ë¡ì„ ë§Œë“¤ì–´ë‘”ë‹¤. 
2. í´ë¼ì´ì–¸íŠ¸ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì˜  getBean() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ìì‹ ì˜ ë¹ˆ ëª©ë¡ì—ì„œ ìš”ì²­í•œ ì´ë¦„ì´ ìˆëŠ”ì§€ ì°¾ê³ , 
   ìˆë‹¤ë©´  ë¹ˆì„ ìƒì„±í•˜ëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ì„œ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±ì‹œí‚¨ í›„ í´ë¼ì´ì–¸íŠ¸ì— ëŒë ¤ì¤€ë‹¤.

ğŸ¤·â€â™‚ï¸ê·¸ë˜ì„œ application contextê°€ ì¥ì ì´ ë­ê¸¸ë˜ DaoFactoryë³´ë‹¤ ë‚«ë‹¤ëŠ” ê±°ì•¼?

1.  í´ë¼ì´ì–¸íŠ¸ëŠ” êµ¬ì²´ì ì¸ íŒ©í† ë¦¬ í´ë˜ìŠ¤ë¥¼ ì•Œ í•„ìš”ê°€ ì—†ë‹¤.

application ì´ ë°œì „í•˜ë©´ DaoFactoryê°™ì€ IoCë¥¼ ì ìš©í•œ objê°€ ì ì  ë§ì•„ì§ˆ ê²ƒì´ê³ , 
â¡í´ë¼ì´ì–¸íŠ¸ê°€ ì–´ëŠ íŒ©í† ë¦¬ í´ë˜ìŠ¤ë¥¼ ì¨ì•¼ ì›í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ì•¼ í•œë‹¤.
â¡ê·¸ ë•Œ ë§ˆë‹¤ ê·€ì°®ê²Œ factory classë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤. 

ê·¸ì¹˜ë§Œ ApplicationContextë¥¼ ì“°ë©´ obj factoryê°€  ì•„ë¬´ë¦¬ ë§ì•„ì ¸ë„ ì´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì•Œ í•„ìš”ê°€ ì—†ì´ ì¼ê´€ì ì¸ ë°©ì‹ìœ¼ë¡œ í•„ìš”í•œ objë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

2. application contextëŠ” ì¢…í•© IoCì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ ì¤€ë‹¤.

application contextëŠ” ë‹¨ìˆœë¦¬ obj ìƒì„±ê³¼ ê´€ê³„ ì„¤ì •ë§Œ í•  ë¿ ì•„ë‹ˆë¼, â¡objê°€ ë§Œë“¤ì–´ì§€ëŠ” ë°©ì‹, ì‹œì ê³¼ ì „ëµì„ ë‹¤ë¥´ê²Œ ê°€ì ¸ê°ˆ ìˆ˜ë„ ìˆê³ 
â¡ìë™ìƒì„±, objì— ëŒ€í•œ í›„ì²˜ë¦¬, ì •ë³´ì˜ ì¡°í•©, ì„¤ì • ë°©ì‹ì˜ ë‹¤ë³€í™”, ì¸í„°ì…‰íŒ… ë“±ì„ ì œê³µí•œë‹¤.
â¡ë¹ˆì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ ê¸°ìˆ  ì„œë¹„ìŠ¤ë‚˜ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ì—°ë™ ë“±ì„ ì»¨í…Œì´ë„ˆ ì°¨ì›ì—ì„œ ì œê³µí•´ì¤€ë‹¤. 

3. ë¹ˆì„ ê²€ìƒ‰í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µí•œë‹¤.

getBean()ìœ¼ë¡œ ë¹ˆì˜ ì´ë¦„ì„ í†µí•´ ë¹ˆì„ ì°¾ëŠ”ë°, íƒ€ì…ë§Œìœ¼ë¡œ ë¹ˆì„ ì°¾ê±°ë‚˜ íŠ¹ë³„í•œ annotationì´ ë¶™ì€ ë¹ˆì„ ì°¾ì„ìˆ˜ë„ ìˆë‹¤.

## 5.3 spring IoC ì˜ ìš©ì–´ ì •ë¦¬

* bean
  * ìŠ¤í”„ë§ì´ IoCë¡œ ê´€ë¦¬í•˜ëŠ” obj
  * ëª¨ë“  objê°€ ë‹¤ ë¹ˆì€ ì•„ë‹˜
* bean factory
  * ìŠ¤í”„ë§ì˜ IoCë¥¼ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ì»¨í…Œì´ë„ˆ
  * ë³´í†µ ì„œë¸Œ í´ë˜ìŠ¤ì¸ application contextë¥¼ ì´ìš©.
  * getBean()ì´ ì •ì˜ë˜ì–´ ìˆìŒ.
* application context
  * bean factoryë¥¼ í™•ì¥í•œ IoC container
* ì„¤ì • ì •ë³´
  * configuration
  * bean factoryê°€ IoCë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë©”íƒ€ ì •ë³´
* container
  * IoC container

# 6. ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì™€ ì˜¤ë¸Œì íŠ¸ ìŠ¤ì½”í”„

ğŸ˜ DaoFactoryì˜ userDao()ë¥¼ ë‘ë²ˆ í˜¸ì¶œí•˜ë©´ ê·¸ ë‘ objëŠ” ë™ì¼í•œê°€?

ë‹¹ì—°íˆ ë‹¤ë¥¸ë‹¤. ë§¤ë²ˆ ìƒˆë¡œ new í•´ì„œ ë°˜í™˜í•˜ë‹ˆê¹Œ.

```java
DaoFactory daoFactory = new DaoFactory();
UserDao dao = daoFactory.userDao();
UserDao dao1 = daoFactory.userDao();
System.out.println("dao = " + dao);
System.out.println("dao1 = " + dao1);
```

í•˜ì§€ë§Œ ApplicationContextë¥¼ ì´ìš©í•˜ë©´ ê°™ì€  UserDao objë¥¼ ë°˜í™˜í•œë‹¤.

```java
AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);
UserDao dao2 = context.getBean("userDao", UserDao.class);
UserDao dao3 = context.getBean("userDao", UserDao.class);
System.out.println("dao2 = " + dao2);
System.out.println("dao3 = " + dao3);
```

## 6.1 ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œì„œì˜ application context

application contextì˜ ì—­í• 

* ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ì™€ ë¹„ìŠ·í•˜ê²Œ ì—­í• í•˜ëŠ”  IoC container
*  ì‹±ê¸€í†¤ì„ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” single registry

### ì„œë²„ application ê³¼ ì‹±ê¸€í†¤

ëŒ€ë¶€ë¶„ì˜ ìŠ¤í”„ë§ì€ ì„œë²„ í™˜ê²½ì—ì„œ ì‚¬ìš©ëœë‹¤. 
ì´ˆë‹¹ ìˆ˜ë°±ë²ˆì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë²„ê°€ ë§¤ ìš”ì²­ë§ˆë‹¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ë©´ ì•„ë¬´ë¦¬ ìš”ì¦˜ GCì„±ëŠ¥ì´ ì¢‹ì•„ë„ ë¶€í•˜ê°€ ê±¸ë¦¬ê¸° ì‹­ìƒì´ë‹¤.

ê³ ë¡œ application ì•ˆì— ì œí•œëœ ìˆ˜, ëŒ€ê°œ í•œ ê°œì˜ objë§Œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ singleton patternì´ë‹¤.  ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ objëŠ” application ë‚´ì—ì„œ ì „ì—­ì ìœ¼ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

### singleton pattern ì˜ í•œê³„

ìë°”ì—ì„œ ì‹±ê¸€í†¤ êµ¬í˜„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

* class ë°–ì—ì„  objë¥¼ ëª» ë§Œë“¤ë„ë¡ ìƒì„±ìë¥¼ privateë°•ëŠ”ë‹¤.
* ìƒì„±ëœ singleton objë¥¼ ì €ì¥í•  static í•„ë“œë¥¼ ì •ì˜í•œë‹¤.
* static factory methodì¸ getInstance()ë¥¼ ë§Œë“¤ê³  ì´ ë©”ì†Œë“œê°€ ì²˜ìŒ í˜¸ì¶œë¬ì„ ë•Œ ì˜¤ë¸Œì íŠ¸ê°€ ë§Œë“¤ì–´ì§€ê³ ,  ë§Œë“¤ì–´ì§„ ì˜¤ë¸Œì íŠ¸ëŠ” ìœ„ì—ì„œ ë§Œë“  static fieldì— ì €ì¥ëœë‹¤. ì´í›„ í˜¸ì¶œì—ì•¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ì€ objë¥¼ ë„˜ê²¨ì¤€ë‹¤.

```java
public class UserDao {
    private ConnectionMaker connectionMaker;
    private static UserDao INSTANCE;

    private UserDao(ConnectionMaker connectionMaker) {
        this.connectionMaker = connectionMaker;
    }

    public static synchronized UserDao getInstance() {
        if (INSTANCE == null) {
            INSTANCE = new UserDao(?);
        }
        return INSTANCE;
    }
    ...
}
```

ğŸ¤”ìƒì„±ìê°€ privateìœ¼ë¡œ ë°”ë€Œë‹ˆê¹Œ DaoFactoryì—ì„œ UserDaoë¥¼ ìƒì„±í•´ ConnectionMakerë¥¼ ë„£ì–´ ì£¼ëŠ” ê²ƒë„ ì´ì   ì•ˆë˜ê² ëŠ”ê±¸?

ì‹±ê¸€í†¤ì˜ ë¬¸ì œëŠ” ì´ê²ƒë¿ë§Œ ì•„ë‹ˆë‹¤.

* private ìƒì„±ìë¥¼ ê°–ê³  ìˆê¸° ë•Œë¬¸ì— ìƒì†í•  ìˆ˜ ì—†ë‹¤.
  * privateì´ ì•„ë‹Œ ìƒì„±ìë¥¼ ê°€ì§€ì§€ ì•Šì€ ì´ìƒ ìƒì†ì´ ì•ˆëœë‹¤. 
  * ê³ ë¡œ ê°ì²´ ì§€í–¥ì˜ ì¥ì ì¸ ìƒì†ê³¼ ë‹¤í˜•ì„±ì„ ì ìš©í•  ìˆ˜ ì—†ë‹¤. 
* í…ŒìŠ¤íŠ¸ í•˜ê¸° í˜ë“¤ë‹¤.
  * ì‹±ê¸€í†¤ì€ ë§Œë“¤ì–´ì§€ëŠ” ë°©ì‹ì´ ì œí•œì ì´ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ì— ì“°ì¼ mock objë“±ìœ¼ë¡œ ëŒ€ì²´í•˜ê¸° ì–´ë µë‹¤. 
  * ì´ˆê¸°í™” ê³¼ì •ì—ì„œ ìƒì„±ì ë“±ì„ í†µí•´ ì‚¬ìš©í•  objë¥¼ dynamicí•˜ê²Œ ì£¼ì…í•˜ê¸° í˜ë“¤ê¸° ë•Œë¬¸ì— í•„ìš”í•œ objëŠ” ì§ì ‘ ë§Œë“¤ì–´ ì¨ì•¼ í•œë‹¤. 
* ì„œë²„ í™˜ê²½ì—ì„œëŠ” ì‹±ê¸€í†¤ì´ í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì„ ë³´ì¥í•˜ì§€ ëª»í•œë‹¤.
  * ì„œë²„ì—ì„œ class loaderë¥¼ ì–´ë–»ê²Œ êµ¬ì„±í–ˆëŠ”ì§€ì— ë”°ë¼ singleton classë„ ì—¬ëŸ¬ê°œì˜ objê°€ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆë‹¤
  * ì—¬ëŸ¬ê°œì˜ JVMì— ë¶„ì‚°ë¼ì„œ ì„¤ì¹˜ë˜ëŠ” ê²½ìš°ì—ë„ ê°ê° ë…ë¦½ì ìœ¼ë¡œ ìƒê¸°ê¸°ì— singleton pattern ì´ ê¹¨ì§„ë‹¤.
* singleton ì‚¬ìš©ì€ ì „ì—­ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¶€ì ì ˆí•˜ë‹¤.
  * singleton ì€ static methodë¥¼ ì‚¬ìš©í•´ ì–´ë””ì„œë“  ì‚¬ìš©ë  ìˆ˜ ìˆëŠ”ë°, 
    ê·¸ëŸ¬ë‹¤ ë³´ë©´ global stateë¡œ ì‚¬ìš©ë˜ê¸° ì‰½ë‹¤.
  * ì•„ë¬´ ê°ì²´ë‚˜ ììœ ë¡­ê²Œ ì ‘ê·¼í•˜ê³  ìˆ˜ì •í•˜ê³  ê³µìœ í•  ìˆ˜ ìˆëŠ” ì „ì—­ ìƒíƒœë¥¼ ê°ì²´ì§€í–¥ì— ìœ„ë°°ëœë‹¤.

### singleton registry

ìœ„ì™€ ê°™ì€ ì‹±ê¸€í†¤ì˜ ë‹¨ì ë“¤ ë–„ë¬¸ì— ìŠ¤í”„ë§ì€ ì§ì ‘ ì‹±ê¸€í†¤ì„ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ê³  ê³µê¸‰í•œë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ singleton registryë¼ ë¶€ë¥¸ë‹¤.

singleton registryì˜ ì¥ì ì€

*  static method, private constructorë¥¼ ì¨ì•¼í•˜ëŠ” ë¹„ì •ìƒì ì¸ classê°€ ì•„ë‹ˆë¼ í‰ë²”í•œ classë¥¼ singletonìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ ì¤€ë‹¤.
  ë•ë¶„ì— singletonìœ¼ë¡œ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ëŠ” í™˜ê²½ì´ ì•„ë‹ˆë¼ë©´ public constructorë¡œ ììœ ë¡­ê²Œ objë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ê°™ì€ ì´ìœ ë¡œ mock objë¡œ ëŒ€ì²´í•˜ê¸°ë„ ì‰½ë‹¤.
* ìƒì„±ì parameterë¡œ ì‚¬ìš©í•  objë¥¼ ë„£ì–´ì¤„ ìˆ˜ë„ ìˆë‹¤.

ì´ë ‡ê²Œ ìŠ¤í”„ë§ì´ ë¹ˆì„ singletonìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì€ ê²°êµ­ objìƒì„± ë°©ë²•ì„ ì œì–´í•˜ëŠ” IoC ì»¨í…Œì´ë„ˆì˜ ì—…ë¬´ ì¤‘ í•˜ë‚˜ì´ë‹¤. 

ğŸ¤”ê·¸ë ‡ë‹¤ë©´ singletonìœ¼ë¡œ ë§Œë“¤ì–´ ì§€ê¸° ë•Œë¬¸ì— ì£¼ì˜í•  ì ì€ ë¬´ì—‡ì¼ê¹Œ?

## 6.2 singleton ê³¼ objì˜ ìƒíƒœ

singletonì€ multi-threadí™˜ê²½ì´ë¼ë©´ ì—¬ëŸ¬ ì“°ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•´ ì“¸ ìˆ˜ ìˆë‹¤. 
ê³ ë¡œ ìƒíƒœ ì •ë³´ë¥¼ ë‚´ë¶€ì— ê°–ê³  ìˆì§€ ì•Šê²Œ(Stateless)ë§Œë“¤ì–´ì•¼ í•œë‹¤. 

ğŸ¤”ê·¸ë ‡ë‹¤ë©´ ì˜¤ê°€ëŠ” ì •ë³´ëŠ” ì–´ë–»ê²Œ ë‹¤ë¤„ì•¼ í• ê¹Œ? 

ë°”ë¡œ ë©”ì†Œë“œ parameterë‚˜ local variable, return valueë“±ì„ ì´ìš©í•˜ë©´ ëœë‹¤. 
ì´ë“¤ì€ ë§¤ë²ˆ ìƒˆë¡œìš´ ê°’ì„ ì €ì¥í•  ë…ë¦½ì ì¸ ê³µê°„ì„ ë§Œë“¤ê¸° ë•Œë¬¸ì— singletonì´ë¼ê³  threadsê°€ ë³€ìˆ˜ì˜ ê°’ì„ ë®ì–´ì“¸ ì¼ì€ ì—†ë‹¤. 

ğŸ˜ë‹¹ì—°íˆ ì½ê¸° ì „ìš© ì •ë³´ë¼ë©´ ì‹±ê¸€í†¤ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•´ë„ ì¢‹ê² ì§€?

## 6.3 ìŠ¤í”„ë§ ë¹ˆì˜ ìŠ¤ì½”í”„

scope = ë¹ˆì´ ìƒì„±ë˜ê³  ì¡´ì¬í•˜ê³  ì ìš©ë˜ëŠ” ë²”ìœ„

scope ì¢…ë¥˜

* singleton scope
  * ê¸°ë³¸ scopeëŠ” singleton scopeì´ë‹¤. ì´ ì¹œêµ¬ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ì— í•œ ê°œì˜ objë§Œ ë§Œë“¤ì–´ì ¸ ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ëŠ”í•œ ê³„ì† ìœ ì§€ëœë‹¤. 
* prototype scope
  * ì»¨í…Œì´ë„ˆì— ë¹ˆì„ ìš”ì²­ í•  ë•Œë§ˆë‹¤ ë§¤ë²ˆ ìƒˆë¡œìš´ objë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤ .
* request scope
  * ì›¹ì„ í†µí•´ ìƒˆë¡œìš´ http ìš”ì²­ì´ ìƒê¸¸ ë•Œ ë§ˆë‹¤ ìƒì„±
* session scope

# 7. ì˜ì¡´ ê´€ê³„ ì£¼ì… (DI)

## 7.1 IoCì™€ ì˜ì¡´ê´€ê³„ ì£¼ì…

DaoFactoryì²˜ëŸ¼ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì¼ë°˜í™” í•œ ê²ƒì´ ìŠ¤í”„ë§ì˜ IoC containerë‹¤. ê·¸ëŸ°ë° ì´ IoCê°€ ì›Œë‚™ ìì£¼ ì ìš©ë˜ëŠ” ê°œë…ì´ë‹¤ ë³´ë‹ˆ ìŠ¤í”„ë§ì˜ ê¸°ëŠ¥ì„ ëª…í™•í•˜ê²Œ ì„¤ëª…í•˜ê¸°ì—” ëª¨í˜¸í•˜ë‹¤. ë”°ë¼ì„œ ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” IoCë°©ì‹ì„ "dependency injection" ì´ë¼ê³  ëª…ëª…í•œë‹¤.

DIëŠ” obj referenceë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ê³ , ì´ë¥¼ í†µí•´ ë‹¤ì´ë‚˜ë¯¹í•˜ê²Œ ì£¼ë³€ objì™€ ì˜ì¡´ê´€ê³„ë¥¼ ë§Œë“ ë‹¤.

## 7.2 ëŸ°íƒ€ì„ ì˜ì¡´ ê´€ê³„ ì„¤ì •

### ì˜ì¡´ ê´€ê³„

![image](https://github.com/mtak0235/TIL/assets/48946398/00118e9a-80fb-4700-9aee-bf9e5aecb05c)

Aê°€ Bì— ì˜ì¡´í•œë‹¤. == Bê°€ ë³€í•˜ë©´ Aê°€ ì˜í–¥ì„ ë°›ëŠ”ë‹¤. 

### UserDaoì˜ ì˜ì¡´ê´€ê³„

ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì˜ì¡´ ê´€ê³„ë¥¼ ì œí•œí•´ì£¼ë©´ ê·¸ë§Œí¼ ë³€ê²½ì—ì„œ ììœ ë¡œì›Œì§„ë‹¤. 
ì´ë ‡ê²Œ ëŠìŠ¨í•œ ì˜ì¡´ ê´€ê³„ë¥¼ ê°–ëŠ” ê²½ìš° UserDaoì˜ objê°€ ì–´ë–¤ í´ë˜ìŠ¤ì˜ objë¥¼ ì“¸ì§€ ë¯¸ë¦¬ ì•Œ ìˆ˜ ì—†ë‹¤. 

ì˜ì¡´ ê´€ê³„ ì£¼ì…ì˜ ì„¸ê°€ì§€ í•„ìˆ˜ ì¡°ê±´

* í´ë˜ìŠ¤ ëª¨ë¸ì´ë‚˜ ì½”ë“œì—ë„Œ ëŸ°íƒ€ì„ ì‹œì ì˜ ì˜ì¡´ ê´€ê³„ê°€ ë“œëŸ¬ë‚˜ì§€ ì•ŠëŠ”ë‹¤.
  * ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ê³  ìˆì–´ì•¼ í•œë‹¤.
* ëŸ°íƒ€ì„ ì‹œì ì˜ ì˜ì¡´ ê´€ê³„ëŠ” ì»¨í…Œì´ë„ˆë‚˜ íŒ©í† ë¦¬ ê°™ì€ **ì œ3ì˜ ì¡´ì¬**ê°€ ê²°ì •í•œë‹¤.
  * DaoFactory, ApplicationContext, Bean factory, IoC container
* ì˜ì¡´ê´€ê³„ëŠ” ì‚¬ìš©í•  objì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì™¸ë¶€ì—ì„œ ì œê³µ(ì£¼ì…)í•´ì¤Œìœ¼ë¡œì¨ ë§Œë“¤ì–´ì§„ë‹¤.

### UserDaoì˜ ì˜ì¡´ ê´€ê³„ ì£¼ì…

ì²˜ìŒì—..

```java
public UserDao() {
connectionMaker = new DConnectionMaker();
}
```

ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¼ì›Œì„œ UserDaoì™€ ConnectionMakerì˜ ì˜ì¡´ ê´€ê³„ë¥¼ ëŠìŠ¨í•˜ê²ŒëŠ” í–ˆì§€ë§Œ ì—¬ì „íˆ ì„¤ê³„ ì‹œì ì—ì„œ UserDaoê°€ DConnectionMakerë¼ëŠ” êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ë¥¼ ì•Œê³  ìˆì—ˆë‹¤. ì¦‰, ëª¨ë¸ë§ ë•Œì˜ ì˜ì¡´ê´€ê³„ì¸ ConnectionMakerë¿ ë§Œ ì•„ë‹ˆë¼ ëŸ°íƒ€ì„ ì˜ì¡´ê´€ê³„ì¸ DConnectionMakerê¹Œì§€ ì•Œê³  ìˆë‹¤.  => ì˜ì¡´ê´€ê³„ê°€ ì½”ë“œ ì†ì— ë‹¤ ë¯¸ë¦¬ ê²°ì •ë˜ì–´ ìˆë‹¤!

ğŸ˜IoCë°©ì‹ìœ¼ë¡œ UserDaoë¡œë¶€í„° ëŸ°íƒ€ì„ ì˜ì¡´ê´€ê³„ë¥¼ ë“œëŸ¬ë‚´ëŠ” ì½”ë“œë¥¼ ëœì–´ë‚´ ì œ 3ì˜ ì¡´ì¬(DaoFactory)ì—ê²Œ ìœ„ì„í•œë‹¤.

```java
public class UserDao {
private ConnectionMaker connectionMaker;
 
public UserDao(ConnectionMaker connectionMaker) {
 this.connectionMaker = connectionMaker;
}
â€¦
}
```

=> ë‘ ê°œì˜ ì˜¤ë¸Œì íŠ¸ ê°„ì— ëŸ°íƒ€ì„ ì˜ì¡´ê´€ê³„ê°€ ë§Œë“¤ì–´ì¡Œë‹¤!

## 7.3 ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ê³¼ ì£¼ì…

ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ì€ ëŸ°íƒ€ì„ ì‹œ ì˜ì¡´ê´€ê³„ë¥¼ ë§ºì„ ì˜¤ë¸Œì íŠ¸ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒê³¼ ì˜¤ë¸Œì íŠ¸ì˜ ìƒì„± ì‘ì—…ì€ ì™¸ë¶€ ì»¨í…Œì´ë„ˆì—ê²Œ IoCë¡œ ë§¡ê¸°ì§€ë§Œ, 
ì´ë¥¼ ê°€ì ¸ì˜¬ ë•ŒëŠ” ë©”ì†Œë“œë‚˜ ìƒì„±ìë¥¼ í†µí•œ ì£¼ì… ëŒ€ì‹   **ìŠ¤ìŠ¤ë¡œ ì»¨í…Œì´ë„ˆì—ê²Œ ìš”ì²­**í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤.

ì¦‰, ì½”ë“œ ì•ˆì— obj factory classë‚˜ spring apiê°€ ë‚˜íƒ€ë‚œë‹¤. 

```java
public UserDao() {
DaoFactory daoFactory = new DaoFactory();
this.connectionMaker = daoFactory.connectionMaker();
}

```

=> ì™¸ë¶€ë¡œë¶€í„°ì˜ ì£¼ì…ì´ ì•„ë‹ˆë¼ ìŠ¤ìŠ¤ë¡œ IoC ì»¨í…Œì´ë„ˆì¸ DaoFactoryì—ê²Œ ìš”ì²­í•œë‹¤.

ğŸ˜ìŠ¤í”„ë§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¼ë©´ ë¯¸ë¦¬ ì •í•´ë†“ì€  ì´ë¦„ì„ ì „ë‹¬í•´ì„œ ê·¸ ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì°¾ê²Œ ëœë‹¤. 

getBean()ì´ ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ì— ì‚¬ìš©ëœë‹¤. 

```java
public UserDao() {
AnnotationConfigApplicationContext context = 
 new AnnotationConfigApplicationContext(DaoFactory.class);
 this.connectionMaker = context.getBean("connectionMaker", ConnectionMaker.class);
}
```

| ì˜ì¡´ê´€ê³„ ê²€ìƒ‰                                                | ì˜ì¡´ ê´€ê³„ ì£¼ì…                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ê²€ìƒ‰ì„ ì‹œì‘í•˜ë ¤ëŠ” ìì‹ ì€ spring beanì¼ í•„ìš”ê°€ ì—†ë‹¤.<br />ì„œë²„ì—ëŠ” main()ê°™ì€ ê¸°ë™ ë©”ì„œë“œëŠ” ì—†ì§€ë§Œ<br />ì‚¬ìš©ìì˜ ìš”ì²­ ë§ˆë‹¤ ë¹„ìŠ·í•œ ì—­í• ì„ í•˜ëŠ” servletì—ì„œ spring containerì— ë‹´ê¸´ obj ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´<br /> í•œë²ˆì€ ì˜ì¡´ ê´€ê³„ ê²€ìƒ‰ìœ¼ë¡œ objë¥¼ ë¶ˆëŸ¬ ì™€ì•¼ í•œë‹¤. | ê²€ìƒ‰ì„ í•˜ë ¤ëŠ” ìì‹ ê³¼ ê²€ìƒ‰ ëŒ€ìƒ ëª¨ë‘ spring beanì´ì–´ì•¼ í•œë‹¤.<br />ì˜ì¡´ì„± ì£¼ì…ì„ í•´ì£¼ë ¤ë©´ UserDaoì— ëŒ€í•œ ìƒì„±ê³¼ ì´ˆê¸°í™” ê¶Œí•œì„ ê°–ê³  ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤. |



## 7.4 ì˜ì¡´ê´€ê³„ ì£¼ì…ì˜ ì‘ìš©

DIì˜ ì‘ìš© ì‚¬ë¡€ë¥¼ ìƒê°í•´ë³´ì

###  ê¸°ëŠ¥ êµ¬í˜„ì˜ êµí™˜

ê°œë°œ ì¤‘ ë¡œì»¬ DBì—ì„œ ì‘ì—… í•˜ë‹¤ê°€ ê°œë°œì´ ëë‚˜ì„œ ë°°í¬í•  ë•Œ  ìš´ì˜ DBì— ì—°ê²°í•´ì•¼ í•œë‹¤. 

ë§Œì•½ DIë¥¼ ì•ˆí•˜ë©´ Daoí´ë˜ìŠ¤ë“¤ì€ ëª¨ë‘ new LocalDBConnectionMaker()ì— ì˜ì¡´í•˜ê³  ìˆì„ ê²ƒì´ë‹¤.  ì´ëŸ¬ë©´ ë°°í¬ì‹œ new ProductDBConnectionMaker()ë¡œ ëª¨ë‘ ë°”ê¿”ì¤˜ì•¼ í•˜ëŠ”ë° ì‹¤ìˆ˜í•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§„ë‹¤.

ë°˜ë©´ DIë¥¼ ì ìš©í–ˆë‹¤ë©´ ëª¨ë“  DaoëŠ” ìƒì„± ì‹œì ì— ConnectionMakeríƒ€ì…ì˜ objë¥¼ ì»¨í…Œì´ë„ˆë¡œë¶€í„° ë°›ëŠ”ë‹¤. ìš°ë¦¬ëŠ” @Configurationì´ ë¶™ì€ DaoFactory í´ë˜ìŠ¤ì— ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •ë§Œ í•´ì£¼ë©´ ëœë‹¤.

```java
@Bean
public ConnectionMaker connectionMaker() {
	 return new LocalDBConnectionMaker();
//     return new ProductionDBConnectionMaker(); ë°°í¬ì‹œ ì´ê²ƒë§Œ ì½”ë“œ ë°”ê¾¸ë©´ ëœë‹¤.
}
```

### ë¶€ê°€ ê¸°ëŠ¥ ì¶”ê°€

DIê°€ ì ìš©ë˜ì§€ ì•Šì•˜ë‹¤ë©´ DB connection ì„ ì¹´ìš´íŒ… í•˜ê³  ì‹¶ì„ ë•Œ ëª¨ë“  makeConenction() í˜¸ì¶œì— ì¹´ìš´íŠ¸ë¥¼ ì¦ê°€ ì‹œí‚¤ëŠ” ì½”ë“œë¥¼ ë„£ì–´ì•¼ í•œë‹¤. ë¶„ì„ ëë‚˜ë©´ ë‹¤ ì œê±°í•´ì•¼í•˜ê³ .. ë˜ë¬¸ì œëŠ” DBì—°ê²° ì¹´ìš´íŒ…ì„ Daoì˜ ê´€ì‹¬ ì‚¬í•­ì´ ì•„ë‹Œë° ì½”ë“œë¥¼ ìˆ˜ì •ë‹¹í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

DI ì»¨í…Œì´ë„ˆë¼ë©´ ì•„ì£¼ ì‰½ê²Œ Daoì™€ DB connetionì„ ë§Œë“œëŠ” objì‚¬ì´ì— ì—°ê²° íšŸìˆ˜ë¥¼ ì¹´ìš´íŒ…í•˜ëŠ” objë¥¼ í•˜ë‚˜ ë” ì¶”ê°€í•˜ë©´ ëœë‹¤. 

```java
package com.example.tobby.user.dao;

import java.sql.Connection;
import java.sql.SQLException;

public class CountingConnectionMaker implements ConnectionMaker {
    int counter = 0;
    private final ConnectionMaker realConnectionMaker;

    public CountingConnectionMaker(ConnectionMaker realConnectionMaker) {
        this.realConnectionMaker = realConnectionMaker;
    }

    @Override
    public Connection makeConnection() throws ClassNotFoundException, SQLException {
        this.counter++;
        return realConnectionMaker.makeConnection();
    }

    public int getCounter() {
        return counter;
    }
}

```

```java
package com.example.tobby.user.dao;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class CountingDaoFactory {
    @Bean
    public UserDao userDao() {
        UserDao userDao = new UserDao(connectionMaker());
        return userDao;
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new CountingConnectionMaker(realConnectionMaker());
    }

    @Bean
    public ConnectionMaker realConnectionMaker() {
        return new DConnectionMaker();
    }
}
```

```java
package com.example.tobby.user.dao;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
class CountingConnectionMakerTest {

    @Test
    void makeConnection() {
        AnnotationConfigApplicationContext context =
                new AnnotationConfigApplicationContext(CountingDaoFactory.class);
        UserDao dao = context.getBean("userDao", UserDao.class);
        CountingConnectionMaker ccm = context.getBean("connectionMaker", CountingConnectionMaker.class);
        System.out.println("ccm.getCounter() = " + ccm.getCounter());
    }
}
```

ğŸ˜ì–´ì©ƒë“  ë¶„ì„ì´ ëë‚˜ë©´ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ë‹¤ì‹œ  CountingDaoFactoryì—ì„œ DaoFactoryë¡œ ë°”ê¾¸ê±°ë‚˜, connectionMaker()ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤!

## 7.5 ë©”ì†Œë“œë¥¼ ì´ìš©í•œ ì˜ì¡´ ê´€ê³„ ì£¼ì…

ì§€ê¸ˆê¹Œì§€ëŠ” UserDaoì˜ DIë¥¼ ìƒì„±ìë¥¼ í†µí•´ì„œë§Œ í–ˆë‹¤.
ìƒì„±ìì— parameterë¥¼ ë§Œë“¤ì–´ ë‘ê³  DI containerê°€ ì˜ì¡´í•  obj referenceë¥¼ ë„˜ê²¨ì£¼ë„ë¡ ë§Œë“¤ì—ˆë‹¤. 

í•˜ì§€ë§Œ DIí•˜ëŠ”ë° ìƒì„±ìë¥¼ ì“¸ í•„ìš” ì—†ì´ ì¼ë°˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤. 

í¬ê²Œ 2ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

1. ìˆ˜ì •ì ë©”ì†Œë“œë¥¼ ì´ìš©í•œ ì£¼ì…
   * setter()
   * í•œë²ˆì— í•œê°œì˜ parameter ë§Œ ê°€ëŠ¥í•˜ë‹¤.ğŸ¥º
   * ì ¤ ë§ì´ ì“´ë‹¤.
2. ì¼ë°˜ ë©”ì†Œë“œë¥¼ ì´ìš©í•œ ì£¼ì…
   * í•œë²ˆì— ì—¬ëŸ¬ê°œì˜ parameterë¥¼ ë°›ì„ ìˆ˜ ìˆê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ğŸ˜UserDaoë„ ìˆ˜ì •ì ë©”ì†Œë“œë¥¼ ì´ìš©í•´ DIí•˜ë„ë¡œ ë§Œë“¤ì–´ ë³´ì

```java
package com.example.tobby.user.dao;

import com.example.tobby.user.domain.User;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class UserDao {
    private ConnectionMaker connectionMaker;

//    public UserDao(ConnectionMaker connectionMaker) {
//        this.connectionMaker = connectionMaker;
//    }

    public void setConnectionMaker(ConnectionMaker connectionMaker) {
        this.connectionMaker = connectionMaker;
    }

    public void add(User user) throws ClassNotFoundException, SQLException, SQLException {
        Connection c = connectionMaker.makeConnection();

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Connection c = connectionMaker.makeConnection();

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }
}

```

```java
package com.example.tobby.user.dao;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class DaoFactory {
    @Bean
    public UserDao userDao() {
        UserDao userDao = new UserDao();
        userDao.setConnectionMaker(connectionMaker());
        return userDao;
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
}


```

# 8. XMLì„ ì´ìš©í•œ ì„¤ì •

ğŸ¤”DaoFactoryëŠ” DIì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì˜ ì´ìš©í•´ ë…ë¦½ì ì¸ obj factory í´ë˜ìŠ¤ë¡œ ì‹œì‘í–ˆì§€ë§Œ, DI containerë¥¼ ë„ì…í•˜ë©´ì„œ @Configurationì„ ì¶”ê°€í•´  DI ì‘ì—…ì— ì°¸ê³ í•˜ëŠ” ì¼ì¢…ì˜ ì°¸ê³  ì •ë³´ë¡œ ì´ìš©ë˜ê³  ìˆì–´.
ê·¼ë° DaoFactoryë¥¼ ë³´ë©´ ë¹„ìŠ·í•œ êµ¬ì¡°ê°€ ë°˜ë³µë˜ê³  DI êµ¬ì„±ì´ ë°”ë€” ë•Œ ë§ˆë‹¤ ìë°” ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  í´ë˜ìŠ¤ë¥¼ ë‹¤ê¸° ì»´íŒŒì¼ í•˜ëŠ” ê²ƒë„ ê·€ì°®ë‹¤. 

ğŸ˜springì€ ìë°” í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒ ì™¸ì—ë„ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ DIì˜ ì„¤ì • ì •ë³´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë° ëŒ€í‘œì ìœ¼ë¡œ XML ì´ ìˆë‹¤.

## 8.1 XML ì„¤ì •

XML  íŒŒì¼ì€ beansë¥¼ @ConfigurationëŒ€ìš©ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
ì¦‰, <beans> ì•ˆì— ì—¬ëŸ¬ê°œì˜ <bean>ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤. 

@Bean ë©”ì†Œë“œë¡œ ì–»ì„ ìˆ˜ ìˆëŠ” ë¹ˆì˜ ì •ë³´ 3ê°€ì§€!

* ë¹ˆì˜ ì´ë¦„
* ë¹ˆì˜ í´ë˜ìŠ¤
* ë¹ˆì˜ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸

### connectionMaker()ì „í™˜

|              | ìë°”ì½”ë“œ ì„¤ì • ì •ë³´     | XML ì„¤ì • ì •ë³´             |
| ------------ | ---------------------- | ------------------------- |
| ë¹ˆ ì„¤ì • íŒŒì¼ | @Configuration         | <beans>                   |
| ë¹ˆì˜ ì´ë¦„    | @Bean methodName()     | <bean id="methodName"     |
| ë¹ˆì˜ í´ë˜ìŠ¤  | return new BeanClass() | class="a.b.c...BeanClass" |

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="connectionMaker" class="com.example.tobby.user.dao.DConnectionMaker"/>
    
</beans>
```

### userDao() ì „í™˜

![image](https://github.com/mtak0235/TIL/assets/48946398/7f25797c-7749-4dd6-89bc-d52a2ddce27e)

xmlì—ì„œëŠ” <property>ë¡œ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì™€ì˜ ê´€ê³„ë¥¼ ì •ì˜í•œë‹¤.
name : ìˆ˜ì •ìì˜ ë©”ì†Œë“œë¥¼ ì•Œ ìˆ˜ ìˆë‹¤. 
ref : ìˆ˜ì •ì ë©”ì†Œë“œë¥¼ í†µí•´ ì£¼ì…í•´ì¤„ ì˜¤ë¸Œì íŠ¸ì˜ ë¹ˆ ì´ë¦„.(idë¶€ë¶„)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="connectionMaker" class="com.example.tobby.user.dao.DConnectionMaker"/>
    <bean id="userDao" class="com.example.tobby.user.dao.UserDao">
        <property name="connectionMaker" ref="connectionMaker"/>
    </bean>
</beans>
```

```java
@Test
void UserDaoXMLTest() throws SQLException, ClassNotFoundException {
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext("test.xml");
    UserDao dao = applicationContext.getBean("userDao", UserDao.class);
    User user = new User();
    user.setId("mta11");
    user.setName("íƒë¯¼ê²½");
    user.setPassword("1004");
    dao.add(user);
    System.out.println("succeed " + user.getId());

    User user1 = dao.get(user.getId());
    System.out.println(user1.getId());
    System.out.println(user1.getName());
    System.out.println(user1.getPassword());
    System.out.println("succeed" + user1.getId());
}
```

ğŸ˜xmlì—ì„  ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì—¬ëŸ¬ê°œ ì •ì˜í•´ ë‘ê³  ê·¸ ì¤‘ì—ì„œ ì›í•˜ëŠ”ê±¸ ê³¨ë¼ DIí•  ìˆ˜ë„ ìˆë‹¤!

```xml
<beans>
<bean id="localDBConnectionMaker" class="...LocalDBConnectionMaker" />
<bean id="testDBConnectionMaker" class="...TestDBConnectionMaker" />
 <bean id="productionDBConnectionMaker" class="...ProductionDBConnectionMaker" />
<bean id="userDao" class="springbook.user.dao.UserDao">
 <property name="connectionMaker" ref="localDBConnectionMaker" />
</bean>
</beans>
```

## 8.2  xmlì„ ì´ìš©í•˜ëŠ” application context

xmlì˜ ë¹ˆ ì˜ì¡´ ê´€ê³„ ì •ë³´ë¥¼ ì´ìš©í•˜ë ¤ë©´,(getBean()) GenericXmlApplicationContextë¥¼ ì‚¬ìš©í•œë‹¤. 

```java
    @Test
    void UserDaoXMLTest() throws SQLException, ClassNotFoundException {
//      ApplicationContext applicationContext = new ClassPathXmlApplicationContext("test.xml");

        GenericXmlApplicationContext applicationContext = new GenericXmlApplicationContext("test.xml");
        UserDao dao = applicationContext.getBean("userDao", UserDao.class);
        User user = new User();
        user.setId("mta12");
        user.setName("íƒë¯¼ê²½");
        user.setPassword("1004");
        dao.add(user);
        System.out.println("succeed " + user.getId());

        User user1 = dao.get(user.getId());
        System.out.println(user1.getId());
        System.out.println(user1.getName());
        System.out.println(user1.getPassword());
        System.out.println("succeed" + user1.getId());
    }
```

xmlì„¤ì • íŒŒì¼ì˜ ì´ë¦„ì€ ì¼ë°˜ì ìœ¼ë¡œ applicationContext.xmlì´ë¼ ì§“ëŠ”ë‹¤.
ìœ„ì¹˜ëŠ” ì¼ë°˜ì ìœ¼ë¡œ /resources ì— ë‘”ë‹¤.

ë§Œì•½ xmlì´ user/dao/test.xmlì— ìˆìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ê°€ì ¸ì˜¤ë©´ ëœë‹¤.

```java
        GenericXmlApplicationContext applicationContext = new GenericXmlApplicationContext("com/example/tobby/user/dao/test.xml");
```

ê²½ë¡œê°€ ë„ˆë¬´ ê¸¸ë‹¤. ì´ ë•ŒëŠ” ClassPathXmlApplicationì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
new ClassPathXmlApplicationContext("daoContext.xml", UserDao.class);
```

ğŸ¤·â€â™‚ï¸ë‚œ ì•ˆë˜ëŠ”ë°? /resources ì•ˆì— ìˆì„ë•Œë§Œ ì¸ì‹í•˜ëŠ”ë°?

## 8.3 DataSource ì¸í„°í˜ì´ìŠ¤ë¡œ ë³€í™˜

ConnectionMakerëŠ”   DB connectionì„ ë§Œë“œëŠ” ê¸°ëŠ¥ í•˜ë‚˜ë§Œ ê°€ì§„ ë§¤ìš° ê°„ë‹¨í•œ ì¸í„°í˜ì´ìŠ¤ë‹¤. ì‚¬ì‹¤ ìë°”ì—ëŠ” ì´ëŸ° ìš©ë„ì˜ ì¸í„°í˜ì´ìŠ¤ê°€ ì´ë¯¸ ìˆë‹¤. ê·¸ê±°ìŠ¨ ë°”ë¡œ DataSourceì¸í„°í˜ì´ìŠ¤.

í•˜ì§€ë§Œ ì´ ë†ˆì€ DB connectionì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒ ì™¸ì—ë„ ì—¬ëŸ¬ ê¸°ëŠ¥ì´ ìˆì–´ì„œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸°ì—” ì¢€ ë¶€ë‹´ìŠ¤ëŸ½ë‹¤.
ê±±ì • ë§ì. ì´ë¯¸ DBì—°ê²° ë¿ ì•„ë‹ˆë¼ poolingê¹Œì§€ ê°–ì¶˜ DataSourceêµ¬í˜„ì²´ë“¤ì´ ë§ë‹¤ . 

ConnectionMakerì˜ makeConnection()ì´ë‚˜ DataSourceì˜ getConnection()ì€ ê°™ì€ ë†ˆì´ë‹¤. 

ğŸ˜ì´ì œ ConnectionMakerëŠ” í•„ìš” ì—†ë‹¤. DataSourceë¡œ ëª¨ì¡°ë¦¬ ë°”ê¿”ë²„ë¦¬ì.

```java
package com.example.tobby.user.dao;

import com.example.tobby.user.domain.User;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class UserDao {
    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    public void add(User user) throws ClassNotFoundException, SQLException, SQLException {
        Connection c = dataSource.getConnection();

        PreparedStatement ps = c.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ps.executeUpdate();
        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Connection c = dataSource.getConnection();

        PreparedStatement ps = c.prepareStatement(
                "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        rs.close();
        ps.close();
        c.close();
        return user;
    }
}

```

ì´ì œ DataSource êµ¬í˜„ í´ë˜ìŠ¤ê°€ í•„ìš”í•˜ë‹¤. DConnectionMakerì²˜ëŸ¼ ë”°ë¡œ ë§Œë“¤ì§€ëŠ” ë§ê³  ìŠ¤í”¼ë§ì´ ì œê³µí•˜ëŠ”  SimpleDriverDataSourceë¥¼ ì‚¬ìš©í•˜ì. 

### ìë°” ì½”ë“œ ì„¤ì • ë°©ì‹

```java
package com.example.tobby.user.dao;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;

import javax.sql.DataSource;

@Configuration
public class DaoFactory {
    @Bean
    public DataSource dataSource(){
        SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
        dataSource.setDriverClass(com.mysql.cj.jdbc.Driver.class);
        dataSource.setUrl("jdbc:mysql://localhost/tobby");
        dataSource.setUsername("tobaby");
        dataSource.setPassword("0000");
        return dataSource;
    }
    @Bean
    public UserDao userDao() {
        UserDao userDao = new UserDao();
        userDao.setDataSource(dataSource());
        return userDao;
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
}

```

###  XMLì„¤ì • ë°©ì‹

```xml
    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource"/>
```

xmlì—ì„  ì–´ë–»ê²Œ dataSource() ì²˜ëŸ¼ DBì—°ê²° ì •ë³´ë¥¼ ë„£ë„ë¡ ì„¤ì •ì„ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?

## 8.4 í”„ë¡œí¼í‹° ê°’ì˜ ì£¼ì…

### ê°’ ì£¼ì…

í…ìŠ¤íŠ¸ë‚˜ ë‹¨ìˆœ ì˜¤ë¸Œì íŠ¸ ë“±ì„ ìˆ˜ì •ì ë©”ì†Œë“œì— ë„£ì–´ ì£¼ëŠ” ê²ƒì„ "ê°’ì„ ì£¼ì…í•œë‹¤"ë¼ê³  í•œë‹¤. 

ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë  í´ë˜ìŠ¤ì— setter() ê°€ ìˆìœ¼ë©´ ì—¬ì „íˆ <property>ë¥¼ ì‚¬ìš©í•´ ì£¼ì…í•  ì •ë³´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì€ ê°™ë‹¤.í•˜ì§€ë§Œ ë‹¤ë¥¸ bean objì˜ refê°€ ì•„ë‹ˆë¼ ë‹¨ìˆœ value ë¥¼ ì£¼ì…í•´ ì£¼ëŠ” ê²ƒì´ë¼ ref attribute ëŒ€ì‹ ì— value attributeë¥¼ ì‚¬ìš©í•œë‹¤. 

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="connectionMaker" class="com.example.tobby.user.dao.DConnectionMaker"/>
    <bean id="userDao" class="com.example.tobby.user.dao.UserDao">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/tobby"/>
        <property name="username" value="tobaby"/>
        <property name="password" value="0000"/>
    </bean>
</beans>
```

### value ê°’ì˜ ìë™ ë³€í™˜

xml íŒŒì¼ì—ì„œ ìŠ¤í”„ë§ì€ valueì—ì„œ ì§€ì •í•œ í…ìŠ¤íŠ¸ ê°’ì„ ì ì ˆí•œ ìë°” íƒ€ì…(Integer, Double, Boolean, Class, URL, File, Charset etc)ìœ¼ë¡œ ë³€í™˜í•´ì¤€ë‹¤. ë˜ ê°’ì´ ì—¬ëŸ¬ê°œë¼ë©´ List, Set, Properties ë‚˜ ë°°ì—´ íƒ€ì…ìœ¼ë¡œë„ ê°’ ì£¼ì…ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
Class driverClass = Class.forName("com.mysql.jdbc.Driver");
dataSource.setDriverClass(driverClass);
```

