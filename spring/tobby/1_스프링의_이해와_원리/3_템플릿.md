í…œí”Œë¦¿ì´ë€ ë°”ë€ŒëŠ” ì„±ì§ˆì´ ë‹¤ë¥¸ ì½”ë“œ ì¤‘ì—ì„œ ë³€ê²½ì´ ê±°ì˜ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë©° ì¼ì • íŒ¨í„´ìœ¼ë¡œ ìœ ì§€ë˜ëŠ” íŠ¹ì„±ì„ ê°€ì§„ ë¶€ë¶„ì„ ììœ ë¡­ê²Œ ë³€ê²½ì´ ë˜ëŠ” ì„±ì§ˆì„ ê°€ì§€ëŠ” ë¶€ë¶„ìœ¼ë¡œë¶€í„° ë…ë¦½ì‹œì¼œ
íš¨ê³¼ì ìœ¼ë¡œ í™œìš©ë  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë°©ë²•

# 1. ë‹¤ì‹œ ë³´ëŠ” ì´ˆë‚œê° DAO

UserDaoëŠ” ì•„ì§ ì˜ˆì™¸ ìƒí™©ì— ëŒ€í•œ ì²˜ë¦¬ê°€ ë˜ì–´ìˆì§€ ì•Šë‹¤.

## 1.1 ì˜ˆì™¸ ì²˜ë¦¬ ê¸°ëŠ¥ì„ ê°–ì¶˜ DAO

ì •ìƒì ì¸ JDBCì½”ë“œì˜ íë¦„ì„ ë”°ë¥´ì§€ ì•Šì•˜ì„ ë•Œ, DB conntection ì´ë¼ëŠ” ì œí•œì ì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜ë“œì‹œ ë°˜í™˜í•´ì•¼í•œë‹¤.

### JDBC ìˆ˜ì • ê¸°ëŠ¥ì˜ ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œ

```java
    public void deleteAll() throws SQLException {
        Connection c = dataSource.getConnection();
        PreparedStatement ps = c.prepareStatement("delete from users");
        ps.executeUpdate();
        ps.close();
        c.close();
    }
```

ê³µìœ  ìì› : connection, preparedStatement

ì—¬ê¸°ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë©”ì†Œë“œì˜ ì‹¤í–‰ì„ ëë§ˆì¹˜ì§€ ëª»í•˜ê³  ë°”ë¡œ ë©”ì†Œë“œë¥¼ ë¹ ì ¸ë‚˜ê°„ë‹¤. ì¦‰, close()ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ ë¦¬ì†ŒìŠ¤ê°€ ë°˜í™˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

> ë³´í†µ connection, preparedStatementëŠ” pool í˜•ì‹ìœ¼ë¡œ ìš´ì˜ëœë‹¤.
> pool ì•ˆì— ì œí•œëœ ìˆ˜ì˜ resourceë¥¼ ë§Œë“¤ì–´ë‘ê³  í•„ìš”í•  ë•Œ ì´ë¥¼ í• ë‹¹í•˜ê³  ë°˜í™˜í•˜ë©´ ë‹¤ì‹œ í’€ì— ë„£ëŠ” ë°©ì‹ì´ë‹¤.
> ìš”ì²­ì´ ë§ì€ ì„œë²„ í™˜ê²½ì— ìœ ë¦¬í•˜ë‹¤.

ğŸ˜ì–´ë–¤ ì˜ˆì™¸ì—ë„ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•˜ê²Œ ë§Œë“¤ì–´ì£¼ì.

/try/catch/finally

```java
    public void deleteAll() throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = c.prepareStatement("delete from users");
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    }
```

close()ë„ try/catchë¥¼ í•´ì•¼í• ê¹Œ ì˜ë¬¸ì´ ë“¤ ìˆ˜ ìˆì§€ë§Œ í•´ì•¼ í•œë‹¤. ì•ˆí–ˆë‹¤ê°€ ìœ„ì˜ close()ì—ì„œ SQLException ë‚˜ë©´ ë‹¤ìŒ ifë¬¸ì´ ì‹¤í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.
ë”°ë¼ì„œ ë§ˆì§€ë§‰ close()ëŠ” ì‚¬ì‹¤ try/catchê°€ ë¶ˆí•„ìš”í•  ìˆ˜ ìˆì§€ë§Œ ì˜ˆì™¸ ì²˜ë¦¬ í•˜ê³ ì‹¶ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ ë„£ì—ˆë‹¤.

### JDBC ì¡°íšŒ ê¸°ëŠ¥ì˜ ì˜ˆì™¸ ì²˜ë¦¬

ê³µìœ  ìì› :  Connection, preparedStatement, ResultSet

â€‹

```java
    public int getCount() throws SQLException {

        Connection c = null;
        PreparedStatement ps = null;
        ResultSet rs = null;
        try {
            c = dataSource.getConnection();
            ps = c.prepareStatement("select count(*) from users");
            rs = ps.executeQuery();
            rs.next();
            return rs.getInt(1);
        } catch (SQLException e) {
            throw e;
        } finally {
            if (rs != null) {
                try {
                    rs.close();
                } catch (SQLException ignored) {
                }
            }
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {

                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                    
                }
            }

        }
    }
```

ì™€ ì½”ë“œ ë°˜ë³µ ë³´ì†Œ

## 2. ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ

## 2.1 JDBC try/catch/finally ì½”ë“œì˜ ë¬¸ì œì 

ë³€í•˜ì§€ ì•Šì§€ë§Œ ì¤‘ë³µë˜ì„œ ë‚˜íƒ€ë‚˜ëŠ” ì½”ë“œì™€ ë¡œì§ì— ë”°ë¼ ìê¾¸ ë³€í•˜ëŠ” ì½”ë“œë¥¼ ì˜ ë¶„ë¦¬í•´ì•¼ í•œë‹¤.

## 2.2 ë¶„ë¦¬ì™€ ì¬ì‚¬ìš©ì„ ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì ìš©

ë³€í•˜ëŠ” ë¶€ë¶„ê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ìœ¼ë¡œ ë¶„ë¦¬í•´ë³´ì

```java
public void deleteAll() throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = c.prepareStatement("delete from users"); //ìœ ì¼í•˜ê²Œ ë³€í•¨
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    }
```

### ë©”ì†Œë“œ ì¶”ì¶œ

```java
    public void deleteAll() throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = makeStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    }

    private PreparedStatement makeStatement(Connection c) throws SQLException {
        return c.prepareStatement("delete from users");
    }
```

ğŸ¤”ë‹¤ë¥¸ ë©”ì†Œë“œì—ë„ ì“¸ ê²ƒì„ ì¶”ì¶œí•´ì•¼ í•˜ëŠ”ë° ë°˜ëŒ€ë¡œ í–ˆë‹¤;;

### í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì˜ ì ìš©

í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ìœ¼ë¡œ ë¶„ë¦¬í•´ ë³´ì. ì´ ì¹œêµ¬ëŠ” ìƒì†ì„ í†µí•´ ê¸°ëŠ¥ì„ í™•ì¥í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì€ ìŠˆí¼ í´ë˜ìŠ¤ì— ë‘ê³ , ë³€í•˜ëŠ” ë¶€ë¶„ì€ ì¶”ìƒ ë©”ì†Œë“œë¡œ ì •ì˜í•´ë‘¬ì„œ ì„œë¸Œ
í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë“œ í•˜ì—¬ ìƒˆë¡­ê²Œ ì •ì˜í•´ ì“°ë„ë¡ í•œë‹¤.

```java
package com.example.tobby.user.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class UserDaoDeleteAll extends UserDao {

    @Override
    protected PreparedStatement makeStatement(Connection c) throws SQLException {
            return c.prepareStatement("delete from users");
    }
}

```

ğŸ¤”ì–´.. ê·¸ëŸ¼ JDBC methodê°€ 4ê°œë©´ UserDaoì˜ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ 4ê°œ ë§Œë“¤ì–´ì•¼ ë˜ë„¤? ì´ë¯¸ ì»´íŒŒì¼ ì‹œì ì—ì„œ ê·¸ ê´€ê³„ê°€ ì •í•´ì ¸ ë²„ë¦¬ë‹ˆê¹Œ ìœ ì—°ì„±ì´ ë–¨ì–´ì§„ë‹¤.

### ì „ëµ íŒ¨í„´ì˜ ì ìš©

í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œë§Œ ì˜ì¡´í•˜ë„ë¡ ë§Œë“œëŠ” íŒ¨í„´.
![image](https://github.com/mtak0235/TIL/assets/48946398/9f86d36a-4459-4318-a0f8-ac21877c4902)

ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ == contextMethod()

deleteAll()ì—ì„œ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„

* DB connection ê°€ì ¸ì˜¤ê¸°
* **PreparedStatementë¥¼ ë§Œë“¤ì–´ì¤„ ì™¸ë¶€ ê¸°ëŠ¥** í˜¸ì¶œí•˜ê¸°
* ì „ë‹¬ë°›ì€ PreparedStatement ì‹¤í–‰í•˜ê¸°
* ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì´ë¥¼ ë‹¤ì‹œ ë©”ì†Œë“œ ë°–ì„ ë˜ì§€ê¸°
* ëª¨ë“  ê²½ìš°ì— ë§Œë“¤ì–´ì§„ PreparedStatement, connection ë‹«ì•„ì£¼ê¸°

"PreparedStatementë¥¼ ë§Œë“¤ì–´ì¤„ ì™¸ë¶€ ê¸°ëŠ¥"  ì´ ì „ëµ íŒ¨í„´ì—ì„œ ë§í•œ strategy!
ì, ì´ì œ ì „ëµì„ ì¸í„°í˜ì´ìŠ¤ë¡œ ëº´ê³  êµ¬í˜„ì²´ê¹Œì§€ ë§Œë“¤ì–´ë³´ì.

```java
package com.example.tobby.user.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public interface StatementStrategy {
    PreparedStatement makePreparedStatement(Connection connection) throws SQLException;
}

```

```java
package com.example.tobby.user.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class DeleteAllStatement implements StatementStrategy {
    @Override
    public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
        PreparedStatement ps = connection.prepareStatement("delete from users");
        return ps;
    }
}

```

```java
public void deleteAll() throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            DeleteAllStatement strategy = new DeleteAllStatement();
            ps = strategy.makePreparedStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    }
```

ğŸ¤”íŠ¹ì • êµ¬í˜„ì²´ë¥¼ ì•Œê³  ìˆë„¤?

### DIì ìš©ì„ ìœ„í•œ client/context ë¶„ë¦¬

ì „ëµ íŒ¨í„´ ê°€ë¼ì‚¬ëŒ€, Contextê°€ ì–´ë–¤ ì „ëµì„ ì‚¬ìš©í•˜ê²Œ í•  ê²ƒì¸ì§€ëŠ” Contextë¥¼ ì‚¬ìš©í•˜ëŠ” ì•ë‹¨ì˜ Clientê°€ ê²°ì •í•œë‹¤. ContextëŠ” Clientë¡œë¶€í„° ì „ë‹¬ ë°›ì€ ê·¸
Strategyêµ¬í˜„ í´ë˜ìŠ¤ì˜ objë¥¼ ì‚¬ìš©í•  ë¿ì´ë‹¤.

ğŸ˜í‹€ì— ë°•íŒ ì‘ì—…ì„ í•˜ëŠ” ì½”ë“œë“¤ì´ ë‹´ê¸´ context methodë¥¼ ë§Œë“¤ì–´ë³´ì.

```java
    public void jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException{
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = stmt.makePreparedStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    } //c
```

ğŸ˜ì, ì´ë²ˆì—ëŠ” ì „ëµ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ê³  ì»¨í…ìŠ¤íŠ¸ë¥¼ í˜¸ì¶œí•˜ëŠ” client methodì¸ deleteAll()ì„ ì‘ì„±í•´ë³´ì.

```java
    public void deleteAll() throws SQLException {
        StatementStrategy st = new DeleteAllStatement();
        jdbcContextWithStatementStrategy(st);
    }
```

> DIì— í•„ìš”í•œ ë°°ìš°ëŠ” ì´ 4ëª…
>
> * ì˜ì¡´ ê´€ê³„ì— ìˆëŠ” obj(strategy) ë‘ê°œ
> * ì´ ê´€ê³„ë¥¼ ë‹¤ì´ë‚˜ë¯¹í•˜ê²Œ ì„¤ì •í•´ì£¼ëŠ” obj factory
> * ì´ë¥¼ ì´ìš©í•˜ëŠ” client

# 3. JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”

> í˜„ ìƒí™©
>
> * UserDaoì˜ deleteAll() :  client
> * jdbcContextWithStatementStrategy() : context
> * PreParedStatement : strategy interface

## 3.1 ì „ëµ í´ë˜ìŠ¤ì˜ ì¶”ê°€ ì •ë³´

add()ì—ë„ ì ìš©í•´ë³´ì!

```java
package com.example.tobby.user.dao;

import com.example.tobby.user.domain.User;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class AddStatement implements StatementStrategy {
    User user;

    public AddStatement(User user) {
        this.user = user;
    }

    @Override
    public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
        PreparedStatement ps = connection.prepareStatement(
                "insert into users (id, name, password) values (?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        return ps;
    }
}

```

```java
    public void add(User user) throws ClassNotFoundException, SQLException
    {
        StatementStrategy statement = new AddStatement(user);
        jdbcContextWithStatementStrategy(statement);
    }
```

## 3.2 ì „ëµê³¼ clientì˜ ë™ê±°

ğŸ¤”Dao ë©”ì†Œë“œ ë§ˆë‹¤ ìƒˆë¡œìš´ StatementStrategy êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤...ì´ëŸ¬ë©´ ë¡œì§ë§ˆë‹¤ ìƒì†ì„ í•˜ëŠ” í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ê³¼ ë‹¤ë¥¼ê²Œ ë­”ê°€? ë˜ Dao
methodì—ì„œ StatementStrategyì— ì „ë‹¬í•  Userê°™ì€ ë¶€ê°€ ì •ë³´ê°€ ìˆëŠ” ê²½ìš° ì´ë¥¼ ë‹´ì•„ë‘˜ objì™€ ì´ê±¸ ì „ë‹¬ ë°›ì„ ìƒì„±ìë„ ë§Œë“¤ì–´ì•¼ í•œë‹¤. ì¦‰, ì´ objê°€ ì“°ì´ëŠ”
ì‹œì ì€ ì „ëµ objë¥¼ í˜¸ì¶œí•  ë•Œ ì´ë¯€ë¡œ ì ì‹œë¼ë„ ì–´ë”˜ê°€ ì €ì¥í•´ ë‘˜ ìˆ˜ ë°–ì— ì—†ë‹¤..

### ë¡œì»¬ í´ë˜ìŠ¤

ğŸ˜í´ë˜ìŠ¤ íŒŒì¼ì´ ë§ì•„ì ¸? StatementStrategy ì „ëµ í´ë˜ìŠ¤ë¥¼ UserDaoë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜í•´ë²„ë ¤! ì–´ì°¨í”¼ DeleteAllStatementë‚˜ AddStatementëŠ”
UserDaoë°–ì— ì•ˆì“°ì–ì•„?

```java
    public void add(User user) throws ClassNotFoundException, SQLException {
        class AddStatement implements StatementStrategy {
            User user;

            public AddStatement(User user) {
                this.user = user;
            }

            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement(
                        "insert into users (id, name, password) values (?,?,?)");
                ps.setString(1, user.getId());
                ps.setString(2, user.getName());
                ps.setString(3, user.getPassword());
                return ps;
            }
        }
        
        StatementStrategy statement = new AddStatement(user);
        jdbcContextWithStatementStrategy(statement);
    }
```

ğŸ¤”ì˜¤í˜¸ AddStatementë¥¼ local classë¡œ ë§Œë“¤ì—ˆêµ°ìš”? ê·¸ë ‡ë‹¤ë©´

> ì¤‘ì²© í´ë˜ìŠ¤
>
> * ë‹¤ë¥¸ í´ë˜ìŠ¤ ë‚´ë¶€ì— ì •ì˜ëœ í´ë˜ìŠ¤
> * ì¢…ë¥˜
    >
* static class
  >
* ë…ë¦½ì ìœ¼ë¡œ objë¡œ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆë‹¤.
>   * inner class
      >
* ìì‹ ì´ ì •ì˜ëœ í´ë˜ìŠ¤ì˜ objì•ˆì—ì„œë§Œ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆë‹¤.
>     * ìì‹ ì´ ì •ì˜ëœ ë©”ì†Œë“œ ì˜ ë¡œì»¬ ë³€ìˆ˜ ì¤‘ finalì´ ë¶™ì€ ë†ˆë“¤ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
>     * ë²”ìœ„ì— ë”°ë¥¸ ì¢…ë¥˜
        >
* member inner class
  >
* member í•„ë“œ ì²˜ëŸ¼ obj ë ˆë²¨ì— ì •ì˜ë¨
>       * local class
          >
* method ë ˆë²¨ì— ì •ì˜ë¨
>       * anonymous inner class
          >
* ì´ë¦„ì´ ì—†ìŒ.

```java
    public void add(User user) throws ClassNotFoundException, SQLException {
        class AddStatement implements StatementStrategy {
            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement(
                        "insert into users (id, name, password) values (?,?,?)");
                ps.setString(1, user.getId());
                ps.setString(2, user.getName());
                ps.setString(3, user.getPassword());
                return ps;
            }
        }

        StatementStrategy statement = new AddStatement();
        jdbcContextWithStatementStrategy(statement);
    }
```

### ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤

* í´ë˜ìŠ¤ì˜ ì„ ì–¸ê³¼ objìƒì„±ì´ ê²°í•©ëœ í˜•íƒœë¡œ ë§Œë“¤ì–´ì§„ë‹¤.
* ìƒì†í•  í´ë˜ìŠ¤ or êµ¬í˜„í•  interfaceë¥¼ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ ë§Œë“¤ì–´ ì“´ë‹¤.
    * `new ì¸í„°í˜ì´ìŠ¤ì´ë¦„ (){ í´ë˜ìŠ¤ ë³¸ë¬¸}`

ğŸ˜AddStatementë¥¼ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ë³´ì

```java
    public void add(User user) throws ClassNotFoundException, SQLException {

        StatementStrategy statement = new StatementStrategy() {
            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement(
                        "insert into users (id, name, password) values (?,?,?)");
                ps.setString(1, user.getId());
                ps.setString(2, user.getName());
                ps.setString(3, user.getPassword());
                return ps;
            }
        };
        jdbcContextWithStatementStrategy(statement);
    }
```

ğŸ¤”ì°¨í”¼ statementí•œë²ˆë°–ì— ì•ˆì“¸ê±° ë…¸ë£©íŒ¨ìŠ¤ ê°€ì

```java
    public void add(User user) throws ClassNotFoundException, SQLException {
        jdbcContextWithStatementStrategy(new StatementStrategy() {

            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement(
                        "insert into users (id, name, password) values (?,?,?)");
                ps.setString(1, user.getId());
                ps.setString(2, user.getName());
                ps.setString(3, user.getPassword());
                return ps;
            }
        });
    }
```

ğŸ˜deleteAllStatement()ë„ ë°”ê¿”ë³´ì

```java
    public void deleteAll() throws SQLException {
        jdbcContextWithStatementStrategy(new StatementStrategy() {
            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement("delete from users");
                return ps;
            }
        });
    }
```

# 4. ì»¨í…ìŠ¤íŠ¸ì™€ DI

## 4.1 JdbcContextì˜ ë¶„ë¦¬

ì „ëµ êµ¬ì¡°ë¡œ ë³´ë©´,,

* UserDao : client
* ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ : strategy êµ¬í˜„ì²´
* jdbcContextWithstatementStrategy : context íŠ¹. ë‹¤ë¥¸ Daoì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥

ğŸ˜jdbcContextWithStatementStrategy()ë¥¼ UserDaoë°–ìœ¼ë¡œ ë…ë¦½ì‹œí‚¤ì.

### í´ë˜ìŠ¤ ë¶„ë¦¬

```java
package com.example.tobby.user.dao;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class JdbcContext {
    
    private final DataSource dataSource;

    public JdbcContext(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    public void jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = stmt.makePreparedStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    }
}
```

```java
public class UserDao {
    private JdbcContext jdbcContext ;
    public void setJdbcContext(JdbcContext jdbcContext) {
        this.jdbcContext = jdbcContext;
    }
    ...
}
```

### ë¹ˆ ì˜ì¡´ê´€ê³„ ë³€ê²½

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="connectionMaker" class="com.example.tobby.user.dao.DConnectionMaker"/>
    <bean id="jdbcContext" class="com.example.tobby.user.dao.JdbcContext">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    <bean id="userDao" class="com.example.tobby.user.dao.UserDao">
        <property name="dataSource" ref="dataSource"/>
        <property name="jdbcContext" ref="jdbcContext"/>
    </bean>
    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/tobby"/>
        <property name="username" value="tobaby"/>
        <property name="password" value="0000"/>
    </bean>
</beans>
```

## 4.2 JdbcContextì˜ íŠ¹ë³„í•  DI

UserDaoëŠ” ì´ì „ì²˜ëŸ¼ interfaceë¥¼ í•˜ë‚˜ ë¼ì§€ë„ ì•Šê³  êµ¬ì²´ í´ë˜ìŠ¤ì¸ JdbcContextë¥¼ ì˜ì¡´í–ˆë‹¤. ë¹„ë¡ ëŸ°íƒ€ì„ ì‹œì— DIë°©ì‹ìœ¼ë¡œ ì™¸ë¶€ì—ì„œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ì…í•´ì£¼ê¸´
í•˜ì§€ë§Œ..

### ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ DI

DIê°€ ë„“ê²Œ ë³´ë©´ ê°ì²´ì˜ ìƒì„±ê³¼ ê´€ê³„ ì„¤ì •ì— ëŒ€í•œ ê¶Œí•œì„ ì™¸ë¶€ì— ì£¼ëŠ” ê²ƒì¸ë°,, ì•„ë¬´ë¦¬ ê·¸ë ‡ë‹¤ í•´ë„ UserDaoê°€ êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ JdbcContextë¥¼ ì£¼ì…ë°›ì•„ì•¼ í•˜ëŠ” ì´ìœ ê°€
ë­˜ê¹Œ?

1. JdbcContextê°€ ì—¬ëŸ¬ clientì—ê²Œ Jdbc context ë©”ì†Œë“œë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ objì´ê¸°ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹±ê¸€í†¤ registryê°€ ê´€ë¦¬í•´ì•¼í•œë‹¤.
2. JdbcContextê°€ DIë¥¼ í†µí•´ ë‹¤ë¥¸ ë¹ˆì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ë‹¤ëŠ” ê±´ ë§¤ìš° ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆë‹¤ëŠ” ì˜ë¯¸ë‹¤. UserDaoê°€ JDBCë°©ì‹ì´ ì•„ë‹Œ JPAë‚˜ ORMì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ JdbcContextë„ í†µì§¸ë¡œ ë°”ë€Œì–´ì•¼ í•œë‹¤.

### ì½”ë“œë¥¼ ì´ìš©í•˜ëŠ” ìˆ˜ë™ DI

JdbcContextë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šê³  ê·¸ ì—­í• ì„ UserDaoì— ìœ„ì„í•˜ëŠ”ê±°ë‹¤!

ëŒ€ì‹  ìœ„ì—ì„œ ë§í•œ ì´ì ì„ ì±™ê²¨ê°€ë ¤ë©´ Daoë§ˆë‹¤ JdbcContextë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ê³ , JdbcContextê°€ ì˜ì¡´í•˜ëŠ” DataSource objëŠ” UserDaoê°€ ì£¼ì…í•´ ì¤˜ì•¼
ê² ì§€ë§Œ..

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
<!--    <bean id="connectionMaker" class="com.example.tobby.user.dao.DConnectionMaker"/>-->
<!--    <bean id="jdbcContext" class="com.example.tobby.user.dao.JdbcContext">-->
<!--        <property name="dataSource" ref="dataSource"/>-->
<!--    </bean>-->
    <bean id="userDao" class="com.example.tobby.user.dao.UserDao">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    <bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/tobby"/>
        <property name="username" value="tobaby"/>
        <property name="password" value="0000"/>
    </bean>
</beans>
```

```java
public class UserDao {

    private JdbcContext jdbcContext ;
    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.jdbcContext = new JdbcContext();
        this.jdbcContext.setDataSource(dataSource);
        
        this.dataSource = dataSource;
    }
}
```

# 5. í…œí”Œë¦¿ê³¼ ë¡¤ë°±

ì§€ê¸ˆê¹Œì§€ ì „ëµ íŒ¨í„´ì˜ ê¸°ë³¸ êµ¬ì¡°ì— ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ í™œìš©í–ˆë‹¤. ì´ëŸ° ë°©ì‹ì„ **template/callback íŒ¨í„´**ì´ë¼ê³  í•œë‹¤.

* template : ì „ëµ íŒ¨í„´ì˜ context
* callback : ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§€ëŠ” obj

> í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´
> ê³ ì •ëœ í‹€ì„ ê°€ì§„ í…œí”Œë¦¿ ë©”ì†Œë“œë¥¼ ìŠˆí¼ í´ë˜ìŠ¤ë¡œ ë‘ê³ , ë°”ë€ŒëŠ” ë¶€ë¶„ì„ ì„œë¸Œ í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œì— ë‘ëŠ” êµ¬ì¡°
>
> ì½œë°±(callback)
> ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ ë‹¤ë¦„ objì˜ ë©”ì†Œë“œì— ì „ë‹¬ë˜ëŠ” obj.
> ìë°”ì—ì„œëŠ” ë©”ì†Œë“œ ìì²´ë¥¼ parameterë¡œ ì „ë‹¬í•  ë°©ë²•ì´ ì—†ì–´ì„œ ë©”ì†Œë“œê°€ ë‹´ê¸´ objë¥¼ ì „ë‹¬í•´ì•¼ í•œë‹¤. ì´ëŸ° objë¥¼ functional objë¼ê³  í•œë‹¤.

## 5.1 í…œí”Œë¦¿/ì½œë°±ì˜ ë™ì‘ ì›ë¦¬

### í…œí”Œë¦¿/ì½œë°±ì˜ íŠ¹ì§•

ì—¬ëŸ¬ ê°œì˜ ë©”ì†Œë“œë¥¼ ê°€ì§„ ì¼ë°˜ì ì¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì „ëµ íŒ¨í„´ê³¼ ë‹¬ë¦¬ ë‹¨ì¼ ë©”ì†Œë“œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” íƒ¬í”Œë¦¿/ì½œë°± íŒ¨í„´ì˜ ì½œë°±ì€ í…œí”Œë¦¿ì˜ ì‘ì—… íë¦„ ì¤‘ íŠ¹ì • ê¸°ëŠ¥ì„
ìœ„í•´ í•œë²ˆë§Œ í˜¸ì¶œëœë‹¤. ë¬¼ë¡  í…œí”Œë¦¿ì—ì„œ ì—¬ëŸ¬ ì „ëµì„ ì‚¬ìš©í•œë‹¤ë©´ ì—¬ëŸ¬ê°œì˜ ì½œë°±ì„ ë„˜ê²¨ì£¼ë©´ ëœë‹¤. => ë©”ì†Œë“œ ë ˆë²¨ì—ì„œ DI

> ì½œë°±ì€ ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ ê°€ì§„ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§„ë‹¤.
> ìš” ë©”ì†Œë“œëŠ” ë³´í†µ ì‘ì—… íë¦„ ì¤‘ì— ë§Œë“¤ì–´ì§€ëŠ” contextì •ë³´ë¥¼ ì „ë‹¬ ë°›ì„ ìš©ë„ì˜ íŒŒë¼ë¯¸í„°ê°€ ìˆë‹¤.

### JdbcContextì— ì ìš©ëœ í…œí”Œë¦¿/ì½œë°±

![image](https://github.com/mtak0235/TIL/assets/48946398/206769d7-baf7-475d-854e-957d6d810cc5)

ì¡°íšŒ ì‘ì—…ì—ëŠ” ë³´í†µ í…œí”Œë¦¿ì˜ ì‘ì—… ê²°ê³¼ë¥¼ clientì—ê²Œ ë¦¬í„´í•´ì¤€ë‹¤.

## 5.2 í¸ë¦¬í•œ ì½œë°±ì˜ ì¬í™œìš©

ë³µì¡í•œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ì˜ ì‚¬ìš©ì„ ìµœì†Œí™” í•´ë³´ì!

```java
    public void deleteAll() throws SQLException {
        jdbcContext.workWithStatementStrategy(new StatementStrategy() {
            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement("delete from users");
                return ps;
            }
        });
    }
```

ğŸ¤”ë°”ì¸ë”©í•  parameter ì—†ì´ ë§Œë“¤ì–´ì§„ SQLì„ ì´ìš©í•´ PreParedStatementë¥¼ ë§Œë“¤ê¸°ë§Œ í•˜ë©´ ë˜ëŠ” ì½œë°±ì´ ë§ì„ ê²ƒ ê°™ë‹¤. ì¦‰, ì €ê¸°ì„œ ë°”ë€” ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²ƒì€ "
delete from users"ë¼ëŠ” ë¬¸ìì—´ ë¿ì´ë‹¤.

```java
    public void deleteAll() throws SQLException {
        executeSql("delete from users");
    }

    private void executeSql(final String query) throws SQLException {
        jdbcContext.workWithStatementStrategy(new StatementStrategy() {
            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement(query);
                return ps;
            }
        });
    }
```

### ì½œë°±ê³¼ í…œí”Œë¦¿ì˜ ê²°í•©

executeSql()ì„ UserDaoë§Œ ì“°ê¸°ì—” ì•„ê¹ë‹¤. ì´ë ‡ê²Œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì„

```java
    public void deleteAll() throws SQLException {
        this.jdbcContext.executeSql("delete from users");
    }
```

```java
package com.example.tobby.user.dao;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class JdbcContext {


    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
    public JdbcContext(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    public JdbcContext() {
    }

    public void executeSql(final String query) throws SQLException {
        workWithStatementStrategy(new StatementStrategy() {
            @Override
            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
                PreparedStatement ps = connection.prepareStatement(query);
                return ps;
            }
        });
    }
    public void workWithStatementStrategy(StatementStrategy stmt) throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = stmt.makePreparedStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                }
            }
            if (c != null) {
                try {
                    c.close();
                } catch (SQLException e) {
                }
            }
        }
    }
}
```

## 5.3 í…œí”Œë¦¿/ì½œë°±ì˜ ì‘ìš©

### í…ŒìŠ¤íŠ¸ì™€ try/catch/finally

ê°„ë‹¨í•œ í…œí”Œë¦¿ ì½œë°± ì˜ˆì œë¥¼ ë§Œë“¤ì–´ë³´ì.

íŒŒì¼ í•˜ë‚˜ ì—´ì–´ì„œ ëª¨ë“  ë¼ì¸ì˜ ìˆ«ìë¥¼ ë”í•œ í•©ì„ ëŒë ¤ì£¼ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ì–´ë³´ê² ë‹¤.

```java
package com.example.tobby;

import com.example.tobby.templateCallback.Calculator;
import org.junit.jupiter.api.Test;

import java.io.IOException;

import static org.assertj.core.api.Assertions.assertThat;

public class CalcSumTest {
    @Test
    public void sumOfNumbers() throws IOException {
        Calculator calculator = new Calculator();
        Integer sum = calculator.calcSum("C:\\Users\\192293\\TIL\\spring\\tobby\\tobby\\src\\test\\java\\com\\example\\tobby\\numbers.txt");
        assertThat(sum).isEqualTo(10);

    }
}

```

```java
package com.example.tobby.templateCallback;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;

public class Calculator {
    public Integer calcSum(String filepath) throws IOException {
        BufferedReader br = new BufferedReader(new FileReader(filepath));
        Integer sum = 0;
        String line = null;
        while ((line = br.readLine()) != null) {
            sum += Integer.valueOf(line);
        }
        br.close();
        return sum;
    }
}

```

íŒŒì¼ì„ ì²˜ë¦¬í•˜ë‹¤ê°€ ì˜ˆì™¸ ìƒí™©ì´ ë°œìƒí•˜ë©´ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê¸°ëŠ¥ë„ ì¶”ê°€í•˜ì

```java
package com.example.tobby.templateCallback;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;

public class Calculator {
    public Integer calcSum(String filepath) throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filepath));
            Integer sum = 0;
            String line = null;
            while ((line = br.readLine()) != null) {
                sum += Integer.valueOf(line);
            }
            br.close();
            return sum;
        } catch (IOException e) {
            System.out.println("e.getMessage() = " + e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println("e.getMessage() = " + e.getMessage());
                }
            }
        }
    }
}

```

### ì¤‘ë³µì˜ ì œê±°ì™€ template/callback ì„¤ê³„

ëª¨ë“  ìˆ«ìì˜ ê³±ì„ ê³„ì‚°í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤ëŠ” ìš”êµ¬ê°€ ìƒê²¼ë‹¤.

ğŸ¤”í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì„ ì ìš©í•˜ë ¤ë©´ ..

1. í…œí”Œë¦¿ì— ë‹´ì„ ë°˜ë³µë˜ëŠ” ì‘ì—… íë¦„ì´ ë¬´ì—‡ì¸ê°€?
2. í…œí”Œë¦¿ì´ ì½œë°±ì— ì „í•´ì¤„ ì •ë³´ëŠ” ë¬´ì—‡ì´ê³ , ì½œë°±ì´ í…œí”Œë¦¿ì— ëŒë ¤ì¤„ ë‚´ìš©ì€ ë¬´ì—‡ì¸ê°€?
3. í…œí”Œë¦¿ì´ ì‘ì—…ì„ ë§ˆì¹œ í›„, clientì—ê²Œ ì „ë‹¬í•  ë‚´ìš©ì€ ë¬´ì—‡ì¸ê°€?

```java
package com.example.tobby.templateCallback;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;

public class Calculator {
    public Integer calcSum(String filepath) throws IOException {
        BufferedReaderCallback sumCallback = new BufferedReaderCallback() {

            @Override
            public Integer doSomethingWithReader(BufferedReader br) throws IOException {
                Integer sum = 0;
                String line = null;
                while ((line = br.readLine()) != null) {
                    sum += Integer.valueOf(line);
                }
                return sum;
            }
        };
        return fileReadTemplate(filepath, sumCallback);
    }

    public Integer calcMultiply(String filepath) throws IOException {
        BufferedReaderCallback multiplyCallback = new BufferedReaderCallback() {
            @Override
            public Integer doSomethingWithReader(BufferedReader br) throws IOException {
                Integer multiply = 1;
                String line = null;
                while ((line = br.readLine()) != null) {
                    multiply *= Integer.valueOf(line);
                }
                return multiply;
            }
        };
        return fileReadTemplate(filepath, multiplyCallback);
    }
    public Integer fileReadTemplate(String filepath, BufferedReaderCallback callback) throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filepath));
            int ret = callback.doSomethingWithReader(br);
            return ret;
        } catch (IOException e) {
            System.out.println("e.getMessage() = " + e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println("e.getMessage() = " + e.getMessage());
                }
            }
        }
    }
}

```

```java
package com.example.tobby.templateCallback;

import java.io.BufferedReader;
import java.io.IOException;

public interface BufferedReaderCallback {
    Integer doSomethingWithReader(BufferedReader br) throws IOException;
}

```

```java
package com.example.tobby.templateCallback;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.IOException;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class CalculatorTest {

    Calculator calculator;
    String numFilePath;
    @BeforeEach
    public void setUp() {
        this.calculator = new Calculator();
        this.numFilePath = "C:\\Users\\192293\\TIL\\spring\\tobby\\tobby\\src\\test\\java\\com\\example\\tobby\\numbers.txt";
    }
    @Test
    void calcSum() throws IOException {
        assertThat(calculator.calcSum(this.numFilePath)).isEqualTo(10);
    }

    @Test
    void calcMultiply() throws IOException {
        assertThat(calculator.calcMultiply(this.numFilePath)).isEqualTo(24);
    }
}
```

### í…œí”Œë¦¿/ì½œë°±ì˜ ì¬ì„¤ê³„

calcMultiply()ì™€ calcSum()ì´ ì—°ì‚° ë¶€ë¶„ ë¹¼ê³  ëª¨ë‘ ë™ì¼í•œ ì½”ë“œë‹¤. ì°¾ì•˜ë‹¤ ì½œë°±!

```java
package com.example.tobby.templateCallback;

public interface LineCallback {
    Integer doSomethingWithLine(String line, Integer value);
}

```

```java
package com.example.tobby.templateCallback;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;

public class Calculator {
    public Integer calcSum(String filepath) throws IOException {
        LineCallback sumCallback = new LineCallback() {

            @Override
            public Integer doSomethingWithLine(String line, Integer value) {
                return value + Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filepath, sumCallback, 0);
    }

    public Integer calcMultiply(String filepath) throws IOException {
        LineCallback sumCallback = new LineCallback() {

            @Override
            public Integer doSomethingWithLine(String line, Integer value) {
                return value * Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filepath, sumCallback, 1);
    }
    public Integer fileReadTemplate(String filepath, BufferedReaderCallback callback) throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filepath));
            int ret = callback.doSomethingWithReader(br);
            return ret;
        } catch (IOException e) {
            System.out.println("e.getMessage() = " + e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println("e.getMessage() = " + e.getMessage());
                }
            }
        }
    }

    public Integer lineReadTemplate(String filepath, LineCallback callback, int initValue) {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filepath));
            Integer ret = initValue;
            String line = null;
            while ((line = br.readLine()) != null) {
                ret = callback.doSomethingWithLine(line, ret);
            }
            return ret;
        } catch (FileNotFoundException e) {
            throw new RuntimeException(e);
        } catch (IOException e) {
            throw new RuntimeException(e);
        } finally {

        }
    }
}

```

### ì œë„¤ë¦­ìŠ¤ë¥¼ ì´ìš©í•œ ì½œë°± ì¸í„°í˜ì´ìŠ¤

íŒŒì¼ì˜ ê° ë¼ì¸ì„ ì—°ê²°í•œ í•˜ë‚˜ì˜ ìŠ¤íŠ¸ë§ì„ ëŒë ¤ì£¼ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ë³´ì!
ê·¼ë° ì½œë°±ì´ê³ , í…œí”Œë¦¿ì´ê³  ì£„ë‹¤ Integerë¥¼ ë°˜í™˜í•˜ë„¤? íƒ€ì… íŒŒë¼ë¯¸í„° ê°œë…ì„ ë„ì…í•œ Genericsë¥¼ ì‚¬ìš©í•´ë³´ì.

```java
package com.example.tobby.templateCallback;

public interface LineCallback<T> {
    T doSomethingWithLine(String line, T value);
}

```

```java
package com.example.tobby.templateCallback;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;

public class Calculator {
    public Integer calcSum(String filepath) throws IOException {
        LineCallback<Integer> sumCallback = new LineCallback<Integer>() {

            @Override
            public Integer doSomethingWithLine(String line, Integer value) {
                return value + Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filepath, sumCallback, 0);
    }

    public Integer calcMultiply(String filepath) throws IOException {
        LineCallback<Integer> sumCallback = new LineCallback<Integer>() {

            @Override
            public Integer doSomethingWithLine(String line, Integer value) {
                return value * Integer.valueOf(line);
            }
        };
        return lineReadTemplate(filepath, sumCallback, 1);
    }

    public String concatenate(String filepath) {
        LineCallback<String> concatenateCallback = new LineCallback<String>() {
            @Override
            public String doSomethingWithLine(String line, String value) {
                return value + line;
            }
        };
        return lineReadTemplate(filepath, concatenateCallback, "");
    }
    public Integer fileReadTemplate(String filepath, BufferedReaderCallback callback) throws IOException {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filepath));
            int ret = callback.doSomethingWithReader(br);
            return ret;
        } catch (IOException e) {
            System.out.println("e.getMessage() = " + e.getMessage());
            throw e;
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    System.out.println("e.getMessage() = " + e.getMessage());
                }
            }
        }
    }

    public <T> T lineReadTemplate(String filepath, LineCallback<T> callback, T initValue) {
        BufferedReader br = null;
        try {
            br = new BufferedReader(new FileReader(filepath));
            T ret = initValue;
            String line = null;
            while ((line = br.readLine()) != null) {
                ret = callback.doSomethingWithLine(line, ret);
            }
            return ret;
        } catch (FileNotFoundException e) {
            throw new RuntimeException(e);
        } catch (IOException e) {
            throw new RuntimeException(e);
        } finally {

        }
    }
}

```

```java
package com.example.tobby.templateCallback;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.IOException;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class CalculatorTest {

    Calculator calculator;
    String numFilePath;
    @BeforeEach
    public void setUp() {
        this.calculator = new Calculator();
        this.numFilePath = "C:\\Users\\192293\\TIL\\spring\\tobby\\tobby\\src\\test\\java\\com\\example\\tobby\\numbers.txt";
    }
    @Test
    void calcSum() throws IOException {
        assertThat(this.calculator.calcSum(this.numFilePath)).isEqualTo(10);
    }

    @Test
    void calcMultiply() throws IOException {
        assertThat(this.calculator.calcMultiply(this.numFilePath)).isEqualTo(24);
    }

    @Test
    public void concatenate() {
        assertThat(this.calculator.concatenate(this.numFilePath)).isEqualTo("1234");
    }
}
```

ğŸ˜ê´€ì „ í¬ì¸íŠ¸

* ë¦¬í„´ ê°’ì„ ê°–ëŠ” í…œí”Œë¦¿
* í…œí”Œë¦¿ ì•ˆì—ì„œ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œë˜ëŠ” ì½œë°±
* genericsíƒ€ì…ì„ ê°–ëŠ” ë©”ì†Œë“œ, ì½œë°± ì¸í„°í˜ì´ìŠ¤

# 6. springì˜ JdbcTemplate

ìŠ¤í”„ë§ì€ JDBCë¥¼ ì´ìš©í•˜ëŠ” DAOì—ê²Œ ì¤„ ë‹¤ì–‘í•œ ì½œë°±ê³¼ í…œí”Œë¦¿ì´ ìˆë‹¤.  
ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” JDBC ì½”ë“œìš© ê¸°ë³¸ í…œí”Œë¦¿ì€ JdbcTemplateì´ë‹¤.

ğŸ˜ì, ì´ì œ JdbcContextë¥¼ ë²„ë¦¬ê³  JdbcTemplateì„ ì‚¬ìš©í•  ì‹œê°„ì´ë‹¤.

```java
public class UserDao {

    private JdbcContext jdbcContext ;
    private DataSource dataSource;

    private JdbcTemplate jdbcTemplate;
    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);

        this.dataSource = dataSource;
    }
}
```

## 6.1 update()

ğŸ˜deleteAll()ì— ë¨¼ì € ì ìš©í•´ë³´ì. ì§€ê¸ˆê¹Œì§€ ë§Œë“  ì½œë°±ì€ StatementStrategy ì¸í„°í˜ì´ìŠ¤ì˜ makePreparedStatement() ë‹¤.

JdbcTemplateì˜ ì½œë°±ì€ PreparedStatementCreator ì¸í„°í˜ì´ìŠ¤ì˜ createPreparedStatement()ë‹¤.

í…œí”Œë¦¿ìœ¼ë¡œë¶€í„° connection ì„ ë°›ì•„ PreparedStatementë¥¼ ë§Œë“¤ì–´ ëŒë ¤ì£¼ëŠ” êµ¬ì¡°ëŠ” ê°™ë‹¤. ì§€ê¸ˆê¹Œì§€ í…œí”Œë¦¿ ë©”ì†Œë“œëŠ”
workWithStatementStrategy()
JdbcTemplateì˜ í…œí”Œë¦¿ ë©”ì†Œë“œëŠ” update()

```java
    public void deleteAll() throws SQLException {
//        this.jdbcContext.executeSql("delete from users");
        this.jdbcTemplate.update(new PreparedStatementCreator() {
            @Override
            public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
                return con.prepareStatement("delete from users");
            }
        });
    }
    
```

ğŸ¤”ì•„..executeSqlì€ SQLë§Œ ì¤˜ë„ ë¯¸ë¦¬ ì¤€ë¹„ëœ ì½œë°±ì„ ë§Œë“¤ì–´ í…œí”Œë¦¿ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒê¹Œì§€ í•œ íì¸ë°..ì € update()ëŠ” ì½œë°±ë„ ì¤˜ì•¼ í•˜ë„¤?

ğŸ˜ì˜¤ë²„ë¼ì´ë“œëœ update()ì¤‘ sqlë§Œ ë„˜ê²¨ë„ ê·¸ë ‡ê²Œ ë™ì‘í•˜ëŠ”ê²Œ ìˆì§€.

```java
    public void deleteAll() throws SQLException {
        this.jdbcTemplate.update("delete from users");
    }
```

ğŸ˜ë¿ë§Œ ì•„ë‹ˆë¼ add()ì˜ ì½œë°±ì´ ìˆ˜í–‰í•˜ëŠ” ë‘ê°€ì§€ ì‘ì—… (PreparedStatementë§Œë“¤ê¸°, íŒŒë¼ë¯¸í„° ë°”ì¸ë”©)
ì„ í›¨ì”¬ ê°„ë‹¨í•˜ê²Œ ë°”ê¿€ ìˆ˜ ìˆì–´.

```java
    public void add(User user) throws ClassNotFoundException, SQLException {
//        jdbcContext.workWithStatementStrategy(new StatementStrategy() {
//
//            @Override
//            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
//                PreparedStatement ps = connection.prepareStatement(
//                        "insert into users (id, name, password) values (?,?,?)");
//                ps.setString(1, user.getId());
//                ps.setString(2, user.getName());
//                ps.setString(3, user.getPassword());
//                return ps;
//            }
//        });
        this.jdbcTemplate.update("insert into users (id, name, password) values(?,?,?)", user.getId(), user.getName(), user.getPassword());
    }
```

## 6.2 queryForInt()

getCount()ì—ì„œ ë³€í•˜ëŠ” ë¶€ë¶„ë§Œ ì½œë°±ìœ¼ë¡œ ë§Œë“¤ì–´ë³´ì.

```java
    public int getCount() throws SQLException {
        return this.jdbcTemplate.query(new PreparedStatementCreator() {
            @Override
            public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
                return con.prepareStatement("select count(*) from users");
            }
        }, new ResultSetExtractor<Integer>() {
            @Override
            public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
                rs.next();
                return rs.getInt(1);
            }
        });
}
```

í…œí”Œë¦¿ ë©”ì†Œë“œ

* query()

ì½œë°±

* PreparedStatementCreator : í…œí”Œë¦¿ìœ¼ë¡œë¶€í„° connection ì„ ë°›ì•„ PreparedStatementë¥¼ ë§Œë“¤ì–´ ëŒë ¤ì£¼ëŠ” ì½œë°±
* ResultSetExtractor :  í…œí”Œë¦¿ì´ PreparedStatement ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ì–»ì€ ResultSetì„ ì „ë‹¬ ë°›ì•„ ì›í•˜ëŠ” ê°’ì„ ì¶”ì¶œí•´ì„œ í…œí”Œë¦¿ì— ì „ë‹¬í•˜ëŠ” ì½œë°±
    * ì œë„¤ë¦­ìŠ¤ íƒ€ì…ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§€ê³  ìˆì–´ ì œë„ˆë¦­ íƒ€ì…ì˜ ë©”ì†Œë“œì—ë„ ì ìš©ë˜ì–´ query()í…œí”Œë¦¿ì˜ ë¦¬í„´ íƒ€ì…ë„ í•¨ê»˜ ë°”ë€ë‹¤.

ğŸ¤”ì½œë°±ì´ ì—¬ëŸ¬ê°œë„¤? sqlì˜ ì‹¤í–‰ ê²°ê³¼ê°€ í•˜ë‚˜ì¸ ì½”ë“œëŠ” í”í•  ê²ƒ ê°™ì•„ì„œ í…œí”Œë¦¿ ì•ˆìœ¼ë¡œ ì˜®ê²¨ë„ ë  ê²ƒ ê°™ì•„. ì´ëŸ° ê¸°ëŠ¥ì„ ë‚´ì¥í•œ queryForObject()ë¼ëŠ” í…œí”Œë¦¿ì´ ìˆë‹¤.

```java
    public int getCount() throws SQLException {
        return this.jdbcTemplate.queryForObject("select count(*) from users", Integer.class);
    }
```

## 6.3 queryForObject()

get()ì— JdbcTemplateì„ ì ìš©í•´ë³´ì.

* sql ë°”ì¸ë”©ì´ í•„ìš”í•œ ì¹˜í™˜ìê°€ ìˆë‹¤.
* ResultSetì—ì„œ ë³µì¡í•œ User objë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

ğŸ˜ResultSetExtractor ì½œë°± ëŒ€ì‹ ì— RowMapperì½œë°±ì„ ì‚¬ìš©í•˜ì. ë‘˜ ë‹¤ ResultSetì„ ì „ë‹¬ ë°›ì•„ í•„ìš”í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì„œ ë¦¬í„´í•˜ëŠ” ë°©ì‹ì´ë‹¤.
ResultSetExtractorëŠ” ResultSetì„ í•œë²ˆ ì „ë‹¬ ë°›ì•„ ì•Œì•„ì„œ ì¶”ì¶œ ì‘ì—…ì„ ëª¨ë‘ ì§„í–‰í•˜ê³  ìµœì¢… ê²°ê³¼ë¥¼ ë°”ë¡œ ë¦¬í„´í•˜ëŠ”ë°, RowMapperëŠ” ResultSetì˜ ë¡œìš°
í•˜ë‚˜ë¥¼ ë§¤í•‘í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ë¡œìš°ê°€ ì—¬ëŸ¬ê°œì´ë©´ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤.

queryForObject()ëŠ” ì¿¼ë¦¬ ì‹¤í–‰ ê²°ê³¼ê°€ í•œ ë¡œìš°ë¼ê³  ê¸°ëŒ€í•œë‹¤. ë”°ë¼ì„œ ì´ë¯¸ rs.next()ë¡œ ì²«ë²ˆì§¸ ë¡œìš°ë¡œ ì´ë™í•´ ìˆëŠ”ë‹¤. ê³ ë¡œ ResultSetì—ì„œ rs.next()
í•  í•„ìš” ì—†ë‹¤.

``` java
    public User get(String id) throws ClassNotFoundException, SQLException {
//        Connection c = dataSource.getConnection();
//
//        PreparedStatement ps = c.prepareStatement(
//                "select * from users where id = ?"
//        );
//        ps.setString(1, id);
//
//        User user = null;
//        ResultSet rs = ps.executeQuery();
//        if (rs.next()) {
//            user = new User();
//            user.setId(rs.getString("id"));
//            user.setName(rs.getString("name"));
//            user.setPassword(rs.getString("password"));
//        }
//        rs.close();
//        ps.close();
//        c.close();
//        if (user == null) throw new EmptyResultDataAccessException(1);
//        return user;
        return this.jdbcTemplate.queryForObject("select * from users where id=?", new Object[]{id},new RowMapper<User>() {
            @Override
            public User mapRow(ResultSet rs, int rowNum) throws SQLException {
                User user = new User();
                user.setId(rs.getString("id"));
                user.setName(rs.getString("name"));
                user.setPassword(rs.getString("password"));
                return user;
            }
        });
```

## 6.4 query()

### ê¸°ëŠ¥ ì •ì˜ì™€ í…ŒìŠ¤íŠ¸ ì‘ì„±

getAll()ë§Œë“¤ì–´ ë³´ì.

```java
    @Test
    public void getAll() throws SQLException, ClassNotFoundException {
        dao.deleteAll();
        dao.add(user1);//yeji
        List<User> users1 = dao.getAll();
        assertThat(users1.size()).isEqualTo(1);
        checkSameUser(user1, users1.get(0));
        dao.add(user2);//doyun
        List<User> users2 = dao.getAll();
        assertThat(users2.size()).isEqualTo(2);
        checkSameUser(user2, users2.get(0));
        checkSameUser(user1, users2.get(1));
        dao.add(user3);//mtak
        List<User> users3 = dao.getAll();
        assertThat(users3.size()).isEqualTo(3);
        checkSameUser(user2, users3.get(0));
        checkSameUser(user1, users3.get(1));
        checkSameUser(user3, users3.get(2));
    }
```

### query() í…œí”Œë¦¿ì„ ì´ìš©í•˜ëŠ” getAll()êµ¬í˜„

queryForObject()ëŠ” ë¡œìš° í•˜ë‚˜ë¥¼ ê¸°ëŒ€í•˜ëŠ” ë°˜ë©´ query()ëŠ” ì—¬ëŸ¬ ê°œì˜ ë¡œìš°ê°€ ë‚˜ì˜¤ëŠ” ê²½ìš°ì— ì“¸ ìˆ˜ ìˆë‹¤.

```java
 public List<User> getAll() {
        return this.jdbcTemplate.query("select * from users order by id", new RowMapper<User>() {
            @Override
            public User mapRow(ResultSet rs, int rowNum) throws SQLException {
                User user = new User();
                user.setId(rs.getString("id"));
                user.setName(rs.getString("name"));
                user.setPassword(rs.getString("password"));
                return user;
            }
        });
    }
```

### í…ŒìŠ¤íŠ¸ ë³´ì™„

getAll() negative testë„ ì¶”ê°€í•´ë³´ì

```java
    @Test
    public void getAll() throws SQLException, ClassNotFoundException {
        dao.deleteAll();
        dao.add(user1);//yeji
        List<User> users1 = dao.getAll();
        assertThat(users1.size()).isEqualTo(1);
        checkSameUser(user1, users1.get(0));
        dao.add(user2);//doyun
        List<User> users2 = dao.getAll();
        assertThat(users2.size()).isEqualTo(2);
        checkSameUser(user2, users2.get(0));
        checkSameUser(user1, users2.get(1));
        dao.add(user3);//mtak
        List<User> users3 = dao.getAll();
        assertThat(users3.size()).isEqualTo(3);
        checkSameUser(user2, users3.get(0));
        checkSameUser(user1, users3.get(1));
        checkSameUser(user3, users3.get(2));
        List<User> users0 = dao.getAll();
        assertThat(users0.size()).isEqualTo(0);
    }
```

## 6.5 ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì˜ ë¶„ë¦¬

### DIë¥¼ ìœ„í•œ ì½”ë“œ ì •ë¦¬

DataSource instanceë¥¼ ì œê±°í•˜ì. ê·¸ë¦¬ê³  jdbcTemplateì„ ì§ì ‘ ìŠ¤í”„ë§ ë°˜ìœ¼ë¡œ ë“±ë¡í•˜ê³  ì‹¶ìœ¼ë‹ˆê¹Œ setDataSourceëŠ” setJdbcTemplateìœ¼ë¡œ
ë°”ê¾¸ì.

```java
public class UserDao {
    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }
}
```

### ì¤‘ë³µ ì œê±°

RowMapperì˜ ë‚´ìš©ì´ ê°™ë„¤? ê¸°ëŠ¥ í™•ì¥ì— ë”°ë¼ ì¤‘ë³µì´ ë” ì‹¬í•´ì§ˆ ê²ƒ ê°™ìœ¼ë‹ˆê¹Œ ì¬ì‚¬ìš©í•˜ì. ê·¸ë¦¬ê³  RowMapperì½œë°±ì€ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ê³µìœ í•˜ì.

```java
package com.example.tobby.user.dao;

import com.example.tobby.user.domain.User;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;

import javax.sql.DataSource;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;


public class UserDao {
    private JdbcTemplate jdbcTemplate;
    private final RowMapper<User> userMapper = new RowMapper<>() {
        @Override
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
        }
    };;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public void add(User user) throws ClassNotFoundException, SQLException {
//        jdbcContext.workWithStatementStrategy(new StatementStrategy() {
//
//            @Override
//            public PreparedStatement makePreparedStatement(Connection connection) throws SQLException {
//                PreparedStatement ps = connection.prepareStatement(
//                        "insert into users (id, name, password) values (?,?,?)");
//                ps.setString(1, user.getId());
//                ps.setString(2, user.getName());
//                ps.setString(3, user.getPassword());
//                return ps;
//            }
//        });
        this.jdbcTemplate.update("insert into users (id, name, password) values(?,?,?)", user.getId(), user.getName(), user.getPassword());
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
//        Connection c = dataSource.getConnection();
//
//        PreparedStatement ps = c.prepareStatement(
//                "select * from users where id = ?"
//        );
//        ps.setString(1, id);
//
//        User user = null;
//        ResultSet rs = ps.executeQuery();
//        if (rs.next()) {
//            user = new User();
//            user.setId(rs.getString("id"));
//            user.setName(rs.getString("name"));
//            user.setPassword(rs.getString("password"));
//        }
//        rs.close();
//        ps.close();
//        c.close();
//        if (user == null) throw new EmptyResultDataAccessException(1);
//        return user;
        return this.jdbcTemplate.queryForObject("select * from users where id=?", new Object[]{id}, userMapper);
    }

    public void deleteAll() throws SQLException {
        this.jdbcTemplate.update("delete from users");
    }


//    abstract protected PreparedStatement makeStatement(Connection c) throws SQLException;

    public int getCount() throws SQLException {
        return this.jdbcTemplate.queryForObject("select count(*) from users", Integer.class);
    }

    public List<User> getAll() {
       
        return this.jdbcTemplate.query("select * from users order by id", userMapper);
    }
}

```

### í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ê³¼ UserDao

ìš•ì‹¬ì´ ë‚œë‹¤.

1. userMapperê°€ ì•ìœ¼ë¡œ ë³€ê²½ ì•ˆë  ê²ƒ ê°™ìœ¼ë‹ˆê¹Œ UserDaoì˜ DIìš© propertyë¡œ ë§Œë“¤ì–´ë²„ë¦¬ë©´ ì–´ë–¨ê¹Œ? UserMapperë¥¼ ë¹ˆìœ¼ë¡œ ë§Œë“¤ê³  XMLì„¤ì •ì—
   Userí…Œì´ë¸”ì˜ í•„ë“œ ì´ë¦„ê³¼ User obj propertyì˜ ë§¤í•‘ ì •ë³´ë„ ë‹´ì„ ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆì„ ê²ƒì´ë‹¤.
2. Dao ë©”ì†Œë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” SQLë¬¸ì¥ì„ UserDaoì½”ë“œê°€ ì•„ë‹ˆë¼ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì— ë‹´ê³  ì´ë¥¼ ì½ì–´ì™€ ì‚¬ìš©í•˜ê²Œ í•˜ëŠ”ê±´ ì–´ë–¨ê¹Œ? DB í…Œì´ë¸” ì´ë¦„ì´ë‚˜ í•„ë“œ ì´ë¦„ì„ ë³€ê²½í•˜ê±°ë‚˜
   SQLì¿¼ë¦¬ë¥¼ ìµœì í™” í•´ì•¼ í•  ë•Œë„ UserDaoì½”ë“œì—ëŠ” ì†ì„ ëŒˆ í•„ìš”ê°€ ì—†ë‹¤. 
